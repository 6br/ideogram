"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Chromosome(t,e,o){this._adapter=t,this._model=this._adapter.getModel(),this._config=e,this._ideo=o,this._color=new Color(this._config),this._bumpCoefficient=5}function TelocentricChromosome(t,e,o){Chromosome.call(this,t,e,o),this._class="TelocentricChromosome",this._pArmOffset=3}function MetacentricChromosome(t,e,o){Chromosome.call(this,t,e,o),this._class="MetacentricChromosome"}function naturalSort(t,e){var o,n,r=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,i=/^\s+|\s+$/g,s=/^0x[0-9a-f]+$/i,a=function(t){return(naturalSort.insensitive&&(""+t).toLowerCase()||""+t).replace(i,"")},c=a(t),l=a(e),u=c.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),h=l.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=parseInt(c.match(s),16)||1!==u.length&&Date.parse(c),f=parseInt(l.match(s),16)||d&&l.match(/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/)&&Date.parse(l)||null,m=function(t,e){return(!t.match(/^0/)||1==e)&&parseFloat(t)||t.replace(/\s+/g," ").replace(i,"")||0};if(f){if(d<f)return-1;if(d>f)return 1}for(var g=0,p=u.length,y=h.length,_=Math.max(p,y);g<_;g++){if(o=m(u[g]||"",p),n=m(h[g]||"",y),isNaN(o)!==isNaN(n))return isNaN(o)?1:-1;if(/[^\x00-\x80]/.test(o+n)&&o.localeCompare){var b=o.localeCompare(n);return b/Math.abs(b)}if(o<n)return-1;if(o>n)return 1}}function slugify(t){return t.toLowerCase().replace(" ","-")}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ChromosomeUtil(t){this._node=t}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),Range=exports.Range=function(){function t(e){_classCallCheck(this,t),this._data=e}return _createClass(t,[{key:"getStart",value:function(){return this._data.start}},{key:"getStop",value:function(){return this._data.stop}},{key:"getLength",value:function(){return this._data.stop-this._data.start}},{key:"getColor",value:function(t){return"ploidy"in this._data?"ploidy"in this._data&&this._data.ploidy[t]?this._getColor(t):"transparent":this._getColor(t)}},{key:"_getColor",value:function(t){return Array.isArray(this._data.color)?this._data.color[t]:this._data.color}}]),t}();Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),ModelAdapter=exports.ModelAdapter=function(){function t(e){_classCallCheck(this,t),this._model=e,this._class="ModelAdapter"}return _createClass(t,[{key:"getModel",value:function(){return this._model}},{key:"getCssClass",value:function(){return""}}],[{key:"getInstance",value:function(e){return e.bands?new t(e):new ModelNoBandsAdapter(e)}}]),t}();Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),ModelNoBandsAdapter=exports.ModelNoBandsAdapter=function(t){function e(t){_classCallCheck(this,e);var o=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o._class="ModelNoBandsAdapter",o}return _inherits(e,t),_createClass(e,[{key:"getModel",value:function(){return this._model.bands=[],this._model.width>1&&this._model.bands.push({name:"q",px:{start:0,stop:this._model.width,width:this._model.width}}),this._model}},{key:"getCssClass",value:function(){return"noBands"}}]),e}(ModelAdapter);Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),Layout=exports.Layout=function(){function t(e,o){if(_classCallCheck(this,t),this._config=e,this._ideo=o,this._ploidy=this._ideo._ploidy,this._translate=void 0,"chrSetMargin"in e)this.chrSetMargin=e.chrSetMargin;else{var n=this._config.chrMargin;this.chrSetMargin=this._config.ploidy>1?n:0}this._tickSize=8,this._isRotated=!1}return _createClass(t,[{key:"_getLeftMargin",value:function(){return this._margin.left}},{key:"_getYScale",value:function(){return 20/this._config.chrWidth}},{key:"getChromosomeLabels",value:function(t){var e=new ChromosomeUtil(t);return[e.getSetLabel(),e.getLabel()].filter(function(t){return t.length>0})}},{key:"rotateBack",value:function(){throw new Error(this._class+"#rotateBack not implemented")}},{key:"rotateForward",value:function(){throw new Error(this._class+"#rotateForward not implemented")}},{key:"rotate",value:function(t,e,o){var n=this._ideo,r=d3.selectAll(n.selector+" g.chromosome").filter(function(){return this!==o});this._isRotated?(this._isRotated=!1,this.rotateBack(t,e,o,function(){r.style("display",null),d3.selectAll(n.selector+" .chrSetLabel, .chrLabel").style("display",null)})):(this._isRotated=!0,r.style("display","none"),d3.selectAll(n.selector+" .chrSetLabel, .chrLabel").style("display","none"),this.rotateForward(t,e,o))}},{key:"getChromosomeLabelClass",value:function(){return 1===this._config.ploidy?"chrLabel":"chrSetLabel"}},{key:"_getAdditionalOffset",value:function(){return(this._config.annotationHeight||0)*(this._config.numAnnotTracks||1)}},{key:"_getChromosomeSetSize",value:function(t){return this._ploidy.getSetSize(t)*this._config.chrWidth*2+this.chrSetMargin}},{key:"getMargin",value:function(){return this._margin}},{key:"getHeight",value:function(){throw new Error(this._class+"#getHeight not implemented")}},{key:"getChromosomeBandTickY1",value:function(){throw new Error(this._class+"#getChromosomeBandTickY1 not implemented")}},{key:"getChromosomeBandTickY2",value:function(){throw new Error(this._class+"#getChromosomeBandTickY2 not implemented")}},{key:"getChromosomeBandLabelTranslate",value:function(){throw new Error(this._class+"#getChromosomeBandLabelTranslate not implemented")}},{key:"getChromosomeSetLabelAnchor",value:function(){return"middle"}},{key:"getChromosomeBandLabelAnchor",value:function(){throw new Error(this._class+"#getChromosomeBandLabelAnchor not implemented")}},{key:"getChromosomeLabelXPosition",value:function(){throw new Error(this._class+"#getChromosomeLabelXPosition not implemented")}},{key:"getChromosomeLabelYPosition",value:function(){return-5.5}},{key:"getChromosomeSetLabelYPosition",value:function(t){return 1===this._config.ploidy?this.getChromosomeLabelYPosition(t):-2*this._config.chrWidth}},{key:"getChromosomeSetLabelXPosition",value:function(){throw new Error(this._class+"#getChromosomeSetLabelXPosition not implemented")}},{key:"getChromosomeSetLabelTranslate",value:function(){throw new Error(this._class+"#getChromosomeSetLabelTranslate not implemented")}},{key:"getChromosomeSetTranslate",value:function(){throw new Error(this._class+"#getChromosomeSetTranslate not implemented")}},{key:"getChromosomeSetYTranslate",value:function(){throw new Error(this._class+"#getChromosomeSetYTranslate not implemented")}}],[{key:"getInstance",value:function(t,e){return"perspective"in t&&"comparative"===t.perspective?new PairedLayout(t,e):"rows"in t&&t.rows>1?new SmallLayout(t,e):"vertical"===t.orientation?new VerticalLayout(t,e):"horizontal"===t.orientation?new HorizontalLayout(t,e):new VerticalLayout(t,e)}}]),t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.HorizontalLayout=void 0;var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_d=require("d3"),_d2=_interopRequireDefault(_d),HorizontalLayout=exports.HorizontalLayout=function(t){function e(t,o){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o));return n._class="HorizontalLayout",n._margin={left:20,top:30},n}return _inherits(e,t),_createClass(e,[{key:"_getLeftMargin",value:function(){var t=Layout.prototype._getLeftMargin.call(this);return this._config.ploidy>1&&(t*=1.8),t}},{key:"rotateForward",value:function(t,e,o,n){var r=_d2.default.select(this._ideo.selector).node().getBoundingClientRect(),i=o.getBoundingClientRect(),s=r.height/(i.width+15)*.9,a=this._getYScale(),c=(e+1)*(2*this._config.chrWidth*a),l="rotate(90) translate(30, -"+c+") scale("+s+", "+a+")";_d2.default.select(o.parentNode).transition().attr("transform",l).on("end",n);var u=this.getChromosomeLabels(o);_d2.default.select(this._ideo.getSvg()).append("g").attr("class","tmp").selectAll("text").data(u).enter().append("text").attr("class",function(t,e){return 0===e&&2===u.length?"chrSetLabel":null}).attr("x",30).attr("y",function(t,e){return 12*(e+1+u.length%2)}).style("text-anchor","middle").style("opacity",0).text(String).transition().style("opacity",1)}},{key:"rotateBack",value:function(t,e,o,n){var r=this.getChromosomeSetTranslate(t);_d2.default.select(o.parentNode).transition().attr("transform",r).on("end",n),_d2.default.selectAll(this._ideo.selector+" g.tmp").style("opacity",0).remove()}},{key:"getHeight",value:function(t){var e=this._config.chromosomes[t].length,o=this.getChromosomeSetYTranslate(e-1);return(o+=this._getChromosomeSetSize(e-1))+2*this._getAdditionalOffset()}},{key:"getWidth",value:function(){return this._config.chrHeight+1.5*this._margin.top}},{key:"getChromosomeSetLabelAnchor",value:function(){return"end"}},{key:"getChromosomeBandLabelAnchor",value:function(){return null}},{key:"getChromosomeBandTickY1",value:function(){return 2}},{key:"getChromosomeBandTickY2",value:function(){return 10}},{key:"getChromosomeBandLabelTranslate",value:function(t){var e=this._ideo.round(-this._tickSize+t.px.start+t.px.width/2);return{x:e,y:-10,translate:"translate("+e+","+-10+")"}}},{key:"getChromosomeSetLabelTranslate",value:function(){return null}},{key:"getChromosomeSetTranslate",value:function(t){return"translate("+this._getLeftMargin()+", "+this.getChromosomeSetYTranslate(t)+")"}},{key:"getChromosomeSetYTranslate",value:function(t){if(!this._config.ploidyDesc)return this._config.chrMargin*(t+1);if(!this._translate){this._translate=[1];for(var e=1;e<this._config.ploidyDesc.length;e++)this._translate[e]=this._translate[e-1]+this._getChromosomeSetSize(e-1)}return this._translate[t]}},{key:"getChromosomeSetLabelXPosition",value:function(t){return 1===this._config.ploidy?this.getChromosomeLabelXPosition(t):-20}},{key:"getChromosomeSetLabelYPosition",value:function(t){var e=this._ploidy.getSetSize(t),o=this._config,n=o.chrMargin,r=o.chrWidth;return 1===o.ploidy?y=r/2+3:y=e*n/2,y}},{key:"getChromosomeLabelXPosition",value:function(){return-8}},{key:"getChromosomeLabelYPosition",value:function(){return this._config.chrWidth}}]),e}(Layout);Object.defineProperty(exports,"__esModule",{value:!0}),exports.VerticalLayout=void 0;var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_d=require("d3"),_d2=_interopRequireDefault(_d),VerticalLayout=exports.VerticalLayout=function(t){function e(t,o){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o));return n._class="VerticalLayout",n._margin={top:30,left:15},n}return _inherits(e,t),_createClass(e,[{key:"rotateForward",value:function(t,e,o,n){var r=this,i=_d2.default.select(this._ideo.selector).node().getBoundingClientRect(),s=o.getBoundingClientRect(),a=i.width/s.height*.97,c=this._getYScale(),l="translate(20, 25) scale("+a+", "+c+")";_d2.default.select(o.parentNode).transition().attr("transform",l).on("end",n);var u=this.getChromosomeLabels(o),h=1.3*(20+r._config.chrWidth);_d2.default.select(this._ideo.getSvg()).append("g").attr("class","tmp").selectAll("text").data(u).enter().append("text").attr("class",function(t,e){return 0===e&&2===u.length?"chrSetLabel":null}).attr("x",0).attr("y",h).style("opacity",0).text(String).transition().style("opacity",1)}},{key:"rotateBack",value:function(t,e,o,n){var r=this.getChromosomeSetTranslate(t);_d2.default.select(o.parentNode).transition().attr("transform",r).on("end",n),_d2.default.selectAll(this._ideo.selector+" g.tmp").style("opacity",0).remove()}},{key:"getHeight",value:function(){return this._config.chrHeight+1.5*this._margin.top}},{key:"getWidth",value:function(){return"97%"}},{key:"getChromosomeBandLabelTranslate",value:function(){}},{key:"getChromosomeSetLabelTranslate",value:function(){return"rotate(-90)"}},{key:"getChromosomeSetTranslate",value:function(t){return"rotate(90) translate("+this._margin.top+", -"+this.getChromosomeSetYTranslate(t)+")"}},{key:"getChromosomeSetYTranslate",value:function(t){var e,o=this._getAdditionalOffset(),n=this._config.chrMargin,r=this._config.chrWidth;if(!this._config.ploidyDesc)return"histogram"===this._config.annotationsLayout?n/2+t*(n+r+2)+2*o+1:(e=r+t*(n+r)+2*o,o>0?e:e+4+2*t);if(!this._translate){this._translate=[this._ploidy.getSetSize(0)*r*2];for(var i,s=1;s<this._config.ploidyDesc.length;s++)i=this._translate[s-1],this._translate[s]=i+this._getChromosomeSetSize(s-1)}return this._translate[t]}},{key:"getChromosomeSetLabelXPosition",value:function(){return this._config.chrWidth*this._config.ploidy/-2}},{key:"getChromosomeLabelXPosition",value:function(){return this._config.chrWidth/-2}}]),e}(Layout);Object.defineProperty(exports,"__esModule",{value:!0}),exports.PairedLayout=void 0;var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_d=require("d3"),_d2=_interopRequireDefault(_d),PairedLayout=exports.PairedLayout=function(t){function e(t,o){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o));return n._class="PairedLayout",n._margin={left:30},n}return _inherits(e,t),_createClass(e,[{key:"rotateForward",value:function(t,e,o,n){var r=this,i=this._ideo,s=_d2.default.select(i.selector).node().getBoundingClientRect(),a=o.getBoundingClientRect(),c=s.width/a.height*.97,l=this._getYScale(),u=t?150:25,h="translate(15, "+u+") scale("+c+", "+l+")";_d2.default.select(o.parentNode).transition().attr("transform",h).on("end",function(){n&&n();var e=6*Number(!t);_d2.default.select(o.parentNode).selectAll("g.bandLabel text").attr("transform","rotate(90) translate(0, "+e+")").attr("text-anchor","middle"),_d2.default.selectAll(i.selector+" .syntenicRegion").style("display","none")});var d=this.getChromosomeLabels(o);_d2.default.select(this._ideo.getSvg()).append("g").attr("class","tmp").selectAll("text").data(this.getChromosomeLabels(o)).enter().append("text").attr("class",function(t,e){return 0===e&&2===d.length?"chrSetLabel":null}).attr("x",0).attr("y",u+r._config.chrWidth*c/2*1.15).style("opacity",0).text(String).transition().style("opacity",1)}},{key:"rotateBack",value:function(t,e,o,n){var r=this._ideo,i=this.getChromosomeSetTranslate(t);_d2.default.select(o.parentNode).transition().attr("transform",i).on("end",function(){n(),_d2.default.selectAll(r.select+" .syntenicRegion").style("display",null),_d2.default.select(o.parentNode).selectAll("g.bandLabel text").attr("transform",null).attr("text-anchor",t?null:"end")}),_d2.default.selectAll(r.selector+" g.tmp").style("opacity",0).remove()}},{key:"getHeight",value:function(){return this._config.chrHeight+1.5*this._margin.left}},{key:"getWidth",value:function(){return"97%"}},{key:"getChromosomeBandTickY1",value:function(t){return t%2?this._config.chrWidth:2*this._config.chrWidth}},{key:"getChromosomeBandTickY2",value:function(t){var e=this._config.chrWidth;return t%2?e-this._tickSize:2*e+this._tickSize}},{key:"getChromosomeBandLabelAnchor",value:function(t){return t%2?null:"end"}},{key:"getChromosomeBandLabelTranslate",value:function(t,e){var o=e%2?10:-this._config.chrWidth-10,n=this._ideo.round(t.px.start+t.px.width/2)+3;return{x:n,y:n,translate:"rotate(-90) translate("+o+", "+n+")"}}},{key:"getChromosomeLabelXPosition",value:function(){return-this._tickSize}},{key:"getChromosomeSetLabelXPosition",value:function(){return this._config.chrWidth/-2}},{key:"getChromosomeSetLabelTranslate",value:function(){return"rotate(-90)"}},{key:"getChromosomeSetTranslate",value:function(t){var e=this.getChromosomeSetYTranslate(t);return"rotate(90) translate("+this._margin.left+", -"+e+")"}},{key:"getChromosomeSetYTranslate",value:function(t){return 200*(t+1)}}]),e}(Layout);Object.defineProperty(exports,"__esModule",{value:!0}),exports.SmallLayout=void 0;var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_d=require("d3"),_d2=_interopRequireDefault(_d),SmallLayout=exports.SmallLayout=function(t){function e(t,o){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o));return n._class="SmallLayout",n._margin={left:36.5,top:10},n}return _inherits(e,t),_createClass(e,[{key:"rotateForward",value:function(t,e,o,n){var r=_d2.default.select(this._ideo.selector).node().getBoundingClientRect(),i=o.getBoundingClientRect(),s=r.width/i.height*.97,a=this._getYScale();transform="translate(5, 25) scale("+s+", "+a+")",_d2.default.select(o.parentNode).transition().attr("transform",transform).on("end",n)}},{key:"rotateBack",value:function(t,e,o,n){var r=this.getChromosomeSetTranslate(t);_d2.default.select(o.parentNode).transition().attr("transform",r).on("end",n)}},{key:"getHeight",value:function(){var t=this._config.chrHeight;return this._config.rows*(t+1.5*this._margin.top)}},{key:"getWidth",value:function(){return"97%"}},{key:"getChromosomeBandLabelTranslate",value:function(){}},{key:"getChromosomeSetLabelTranslate",value:function(){return"rotate(-90)"}},{key:"getChromosomeSetTranslate",value:function(t){var e=[];this._ideo.getTaxids(function(t){e=t});var o,n,r=this._ideo.config.chromosomes[e[0]].length,i=r/this._config.rows;return t>i-1?(o=this._margin.left+1.4*this._config.chrHeight,n=this.getChromosomeSetYTranslate(t-i)):(o=this._margin.left,n=this.getChromosomeSetYTranslate(t)),"rotate(90) translate("+o+", -"+n+")"}},{key:"getChromosomeSetYTranslate",value:function(t){var e=this._getAdditionalOffset();return this._margin.left*t+this._config.chrWidth+2*e+e*t}},{key:"getChromosomeSetLabelXPosition",value:function(t){return(this._ploidy.getSetSize(t)*this._config.chrWidth+20)/-2+(this._config.ploidy>1?0:this._config.chrWidth)}},{key:"getChromosomeLabelXPosition",value:function(){return this._config.chrWidth/-2}}]),e}(Layout);Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),Ploidy=exports.Ploidy=function(){function t(e){_classCallCheck(this,t),this._config=e,this._description=this._normalize(this._config.ploidyDesc)}return _createClass(t,[{key:"getChromosomesNumber",value:function(t){if(this._config.ploidyDesc){var e=this._config.ploidyDesc[t];return e instanceof Object?Object.keys(e)[0].length:e.length}return this._config.ploidy||1}},{key:"_normalize",value:function(t){var e,o,n;if(!t)return t;e=[];for(o in t)n=t[o],"string"==typeof n?("vertical"===this._config.orientation&&(n=n.split("").reverse()),e.push({ancestors:n,existence:this._getexistenceArray(n.length)})):e.push({ancestors:Object.keys(n)[0],existence:n[Object.keys(n)[0]]});return e}},{key:"_getexistenceArray",value:function(t){for(var e=[],o=0;o<t;o++)e.push("11");return e}},{key:"getSetSize",value:function(t){return this._description?this._description[t].ancestors.length:1}},{key:"getAncestor",value:function(t,e){return this._description?this._description[t].ancestors[e]:""}},{key:"exists",value:function(t,e,o){if(this._description){var n=this._description[t].existence[e][o];return Number(n)>0}return!0}}]),t}();Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),Color=exports.Color=function(){function t(e){_classCallCheck(this,t),this._config=e,this._ploidy=new Ploidy(this._config)}return _createClass(t,[{key:"getArmColor",value:function(t,e,o){return this._config.armColors?this._config.armColors[o]:this._config.ancestors?this._getPolyploidArmColor(t,e,o):null}},{key:"getBorderColor",value:function(t,e,o){return e<this._config.ploidy?"#000":this._ploidy.exists(t,e,o)?"#000":"#fff"}},{key:"_getPolyploidArmColor",value:function(t,e,o){if(this._ploidy.exists(t,e,o)){var n=this._ploidy.getAncestor(t,e,o);return this._config.ancestors[n]}return"transparent"}}]),t}();Chromosome.getInstance=function(t,e,o){return"telocentric"===t.getModel().centromerePosition?new TelocentricChromosome(t,e,o):new MetacentricChromosome(t,e,o)},Chromosome.prototype._addPArmShape=function(t,e){return e?t.concat(this._getPArmShape()):t},Chromosome.prototype._addQArmShape=function(t,e){return e?t.concat(this._getQArmShape()):t},Chromosome.prototype.render=function(t,e,o){var n=this;t=t.append("g").attr("class","bands").attr("clip-path","url(#"+this._model.id+"-chromosome-set-clippath)");var r=this._renderPArm(t,e,o),i=this._renderQArm(t,e,o);this._renderRangeSet(t,e,o);var s=[];s=this._addPArmShape(s,r),s=this._addQArmShape(s,i);var a="0",c="",l=this.isFullyBanded();return"ancestors"in this._ideo.config&&!("rangeSet"in this._ideo.config)?(c=n._color.getArmColor(e,o,0),l&&(a="0.5")):l?(a=null,c="transparent"):"ancestors"in this._ideo.config||(a="1"),t.append("g").attr("class","chromosome-border").selectAll("path").data(s).enter().append("path").attr("fill",c).style("fill-opacity",a).attr("stroke",function(t,r){return n._color.getBorderColor(e,o,r)}).attr("stroke-width",function(t){return"strokeWidth"in t?t.strokeWidth:1}).attr("d",function(t){return t.path}).attr("class",function(t){return t.class}),s},Chromosome.prototype._renderRangeSet=function(t,e,o){if("rangeSet"in this._config){var n=this._config.rangeSet.filter(function(t){return t.chr-1===e}).map(function(t){return new Range(t)}),r=t.append("g").attr("class","range-set"),i=this,s=i._ideo,a=s._bandsXOffset;r.selectAll("rect.range").data(n).enter().append("rect").attr("class","range").attr("x",function(t){return s.convertBpToPx(i._model,t.getStart())-a}).attr("y",0).attr("width",function(t){return s.convertBpToPx(i._model,t.getLength())-a}).attr("height",this._config.chrWidth).style("fill",function(t){return t.getColor(o)})}},Chromosome.prototype._getShapeData=function(){for(var t,e=0;e<this._model.bands.length;e++)if("q"===this._model.bands[e].name[0]){t=this._model.bands[e];break}var o=this._model.bands.length-1,n=this._model.bands[o].px.stop;return{x1:0,x2:t?t.px.start:n,x3:n,w:this._config.chrWidth,b:this._config.chrWidth/this._bumpCoefficient}},Chromosome.prototype._getPArmShape=function(){var t=this._getShapeData(),e=t.x2-t.b;return this.isFullyBanded()||"ancestors"in this._ideo.config?{class:"",path:"M"+t.b+",0 L"+e+",0 Q"+(t.x2+t.b)+","+t.w/2+","+e+","+t.w+" L"+t.b+","+t.w+" Q-"+t.b+","+t.w/2+","+t.b+",0"}:[{class:"",path:"M"+t.b+",0 L"+(e-2)+",0 L"+(e-2)+","+t.w+" L"+t.b+","+t.w+" Q-"+t.b+","+t.w/2+","+t.b+",0"},{class:"acen",path:"M"+e+",0 Q"+(t.x2+t.b)+","+t.w/2+","+e+","+t.w+" L"+e+","+t.w+" L"+(e-2)+","+t.w+" L"+(e-2)+",0"}]},Chromosome.prototype._getQArmShape=function(){var t=this._getShapeData(),e=t.x3-t.b,o=t.x2+t.b;return this.isFullyBanded()||"ancestors"in this._ideo.config?{class:"",path:"M"+o+",0 L"+e+",0 Q"+(t.x3+t.b)+","+t.w/2+","+e+","+t.w+" L"+o+","+t.w+" Q"+(t.x2-t.b)+","+t.w/2+","+o+",0"}:[{path:"M"+o+",0 L"+e+",0 Q"+(t.x3+t.b)+","+t.w/2+","+e+","+t.w+" L"+o+","+t.w+" L"+o+",0"},{class:"acen",path:"M"+o+",0Q"+(t.x2-t.b)+","+t.w/2+","+o+","+t.w+" L"+o+","+t.w+"L"+(o+2)+","+t.w+"L"+(o+2)+",0"}]},Chromosome.prototype.isFullyBanded=function(){return this._model.bands&&(2!==this._model.bands.length||"q"===this._model.bands[0].name[0])},Chromosome.prototype._renderBands=function(t,e,o,n,r){var i=this,s="p"===r?0:1,a="";"ancestors"in this._ideo.config&&!this.isFullyBanded()&&(a=i._color.getArmColor(e,o,s)),t.selectAll("path.band."+r).data(n).enter().append("path").attr("id",function(t){return i._model.id+"-"+t.name.replace(".","-")}).attr("class",function(t){return"band "+r+"-band "+t.stain}).attr("d",function(t){var e=i._ideo.round(t.px.start),o=i._ideo.round(t.px.width);return x=e+o,"M "+e+", 0l "+o+" 0 l 0 "+i._config.chrWidth+" l -"+o+" 0 z"}).style("fill",a)},Chromosome.prototype._renderPArm=function(t,e,o){var n=this._model.bands.filter(function(t){return"p"===t.name[0]});return this._renderBands(t,e,o,n,"p"),Boolean(n.length)},Chromosome.prototype._renderQArm=function(t,e,o){var n=this._model.bands.filter(function(t){return"q"===t.name[0]});return this._renderBands(t,e,o,n,"q"),Boolean(n.length)},TelocentricChromosome.prototype=Object.create(Chromosome.prototype),TelocentricChromosome.prototype._addPArmShape=function(t){return t.concat(this._getPArmShape())},TelocentricChromosome.prototype._getPArmShape=function(){var t=this._getShapeData();return t.o=this._pArmOffset,[{class:"acen",path:"M"+(t.x2+2)+",1L"+(t.x2+t.o+3.25)+",1 L"+(t.x2+t.o+3.25)+","+(t.w-1)+" L"+(t.x2+2)+","+(t.w-1)},{class:"gpos66",path:"M"+(t.x2-t.o+5)+",0L"+(t.x2-t.o+3)+",0 L"+(t.x2-t.o+3)+","+t.w+" L"+(t.x2-t.o+5)+","+t.w,strokeWidth:.5}]},TelocentricChromosome.prototype._getQArmShape=function(){var t=this._getShapeData(),e=t.x3-t.b,o=this._pArmOffset+3;return{class:"",path:"M"+(t.x2+o)+",0 L"+e+",0 Q"+(t.x3+t.b)+","+t.w/2+","+e+","+t.w+" L"+(t.x2+o)+","+t.w}},MetacentricChromosome.prototype=Object.create(Chromosome.prototype);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(){function t(t){return"function"==typeof t||"object"==(void 0===t?"undefined":_typeof(t))&&null!==t}function e(t){return"function"==typeof t}function o(t){I=t}function n(t){z=t}function r(){return function(){W(s)}}function i(){return function(){setTimeout(s,1)}}function s(){for(var t=0;q>t;t+=2){(0,V[t])(V[t+1]),V[t]=void 0,V[t+1]=void 0}q=0}function a(t,e){var o=this,n=new this.constructor(l);void 0===n[Z]&&B(n);var r=o._state;if(r){var i=arguments[r-1];z(function(){A(r,n,i,o._result)})}else x(o,n,t,e);return n}function c(t){var e=this;if(t&&"object"==(void 0===t?"undefined":_typeof(t))&&t.constructor===e)return t;var o=new e(l);return y(o,t),o}function l(){}function u(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function d(t){try{return t.then}catch(t){
return nt.error=t,nt}}function f(t,e,o,n){try{t.call(e,o,n)}catch(t){return t}}function m(t,e,o){z(function(t){var n=!1,r=f(o,e,function(o){n||(n=!0,e!==o?y(t,o):b(t,o))},function(e){n||(n=!0,v(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&r&&(n=!0,v(t,r))},t)}function g(t,e){e._state===et?b(t,e._result):e._state===ot?v(t,e._result):x(e,void 0,function(e){y(t,e)},function(e){v(t,e)})}function p(t,o,n){o.constructor===t.constructor&&n===J&&constructor.resolve===K?g(t,o):n===nt?v(t,nt.error):void 0===n?b(t,o):e(n)?m(t,o,n):b(t,o)}function y(e,o){e===o?v(e,u()):t(o)?p(e,o,d(o)):b(e,o)}function _(t){t._onerror&&t._onerror(t._result),C(t)}function b(t,e){t._state===tt&&(t._result=e,t._state=et,0!==t._subscribers.length&&z(C,t))}function v(t,e){t._state===tt&&(t._state=ot,t._result=e,z(_,t))}function x(t,e,o,n){var r=t._subscribers,i=r.length;t._onerror=null,r[i]=e,r[i+et]=o,r[i+ot]=n,0===i&&t._state&&z(C,t)}function C(t){var e=t._subscribers,o=t._state;if(0!==e.length){for(var n,r,i=t._result,s=0;s<e.length;s+=3)n=e[s],r=e[s+o],n?A(o,n,r,i):r(i);t._subscribers.length=0}}function w(){this.error=null}function k(t,e){try{return t(e)}catch(t){return rt.error=t,rt}}function A(t,o,n,r){var i,s,a,c,l=e(n);if(l){if(i=k(n,r),i===rt?(c=!0,s=i.error,i=null):a=!0,o===i)return void v(o,h())}else i=r,a=!0;o._state!==tt||(l&&a?y(o,i):c?v(o,s):t===et?b(o,i):t===ot&&v(o,i))}function L(t,e){try{e(function(e){y(t,e)},function(e){v(t,e)})}catch(e){v(t,e)}}function S(){return it++}function B(t){t[Z]=it++,t._state=void 0,t._result=void 0,t._subscribers=[]}function T(t){return new ut(this,t).promise}function P(t){var e=this;return new e(H(t)?function(o,n){for(var r=t.length,i=0;r>i;i++)e.resolve(t[i]).then(o,n)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function M(t){var e=this,o=new e(l);return v(o,t),o}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(t){this[Z]=S(),this._result=this._state=void 0,this._subscribers=[],l!==t&&("function"!=typeof t&&O(),this instanceof j?L(this,t):D())}function N(t,e){this._instanceConstructor=t,this.promise=new t(l),this.promise[Z]||B(this.promise),H(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):v(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function R(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;(!e||"[object Promise]"!==Object.prototype.toString.call(e.resolve())||e.cast)&&(t.Promise=lt)}var E;E=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var W,I,Y,H=E,q=0,z=function(t,e){V[q]=t,V[q+1]=e,2===(q+=2)&&(I?I(s):Y())},X="undefined"!=typeof window?window:void 0,Q=X||{},U=Q.MutationObserver||Q.WebKitMutationObserver,G="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,V=new Array(1e3);Y=G?function(){return function(){process.nextTick(s)}}():U?function(){var t=0,e=new U(s),o=document.createTextNode("");return e.observe(o,{characterData:!0}),function(){o.data=t=++t%2}}():$?function(){var t=new MessageChannel;return t.port1.onmessage=s,function(){t.port2.postMessage(0)}}():void 0===X&&"function"==typeof require?function(){try{var t=require,e=t("vertx");return W=e.runOnLoop||e.runOnContext,r()}catch(t){return i()}}():i();var J=a,K=c,Z=Math.random().toString(36).substring(16),tt=void 0,et=1,ot=2,nt=new w,rt=new w,it=0,st=T,at=P,ct=M,lt=j;j.all=st,j.race=at,j.resolve=K,j.reject=ct,j._setScheduler=o,j._setAsap=n,j._asap=z,j.prototype={constructor:j,then:J,catch:function(t){return this.then(null,t)}};var ut=N;N.prototype._enumerate=function(){for(var t=this.length,e=this._input,o=0;this._state===tt&&t>o;o++)this._eachEntry(e[o],o)},N.prototype._eachEntry=function(t,e){var o=this._instanceConstructor,n=o.resolve;if(n===K){var r=d(t);if(r===J&&t._state!==tt)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(o===lt){var i=new o(l);p(i,t,r),this._willSettleAt(i,e)}else this._willSettleAt(new o(function(e){e(t)}),e)}else this._willSettleAt(n(t),e)},N.prototype._settledAt=function(t,e,o){var n=this.promise;n._state===tt&&(this._remaining--,t===ot?v(n,o):this._result[e]=o),0===this._remaining&&b(n,this._result)},N.prototype._willSettleAt=function(t,e){var o=this;x(t,void 0,function(t){o._settledAt(et,e,t)},function(t){o._settledAt(ot,e,t)})};var ht=R,dt={Promise:lt,polyfill:ht};"function"==typeof define&&define.amd?define(function(){return dt}):"undefined"!=typeof module&&module.exports?module.exports=dt:void 0!==this&&(this.ES6Promise=dt),ht()}).call(void 0),function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(require("d3")):t.d3.promise=e(t.d3)}(void 0,function(t){var e=function(){function e(t,e){return function(){var o=Array.prototype.slice.call(arguments);return new Promise(function(n,r){var i=function(t,e){return t?void r(Error(t)):void n(e)};e.apply(t,o.concat(i))})}}var o={};return["csv","tsv","json","xml","text","html","get"].forEach(function(n){o[n]=e(t,t[n])}),o}();return t.promise=e,e}),Object.defineProperty(exports,"__esModule",{value:!0}),exports.Ideogram=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_d=require("d3"),_d2=_interopRequireDefault(_d),Ideogram=exports.Ideogram=function(){function Ideogram(t){_classCallCheck(this,Ideogram);var e,o,n,r,i;this.config=JSON.parse(JSON.stringify(t)),this._bandsXOffset=30,this.debug=!1,this.config.dataDir||(this.config.dataDir="../data/bands/native/"),this.config.ploidy||(this.config.ploidy=1),this.config.ploidy>1&&(this.sexChromosomes={},this.config.sex||(this.config.sex="male"),2!==this.config.ploidy||this.config.ancestors||(this.config.ancestors={M:"#ffb6c1",P:"#add8e6"},this.config.ploidyDesc="MP")),this.config.container||(this.config.container="body"),this.selector=this.config.container+" #_ideogram",this.config.resolution||(this.config.resolution=850),"showChromosomeLabels"in this.config==!1&&(this.config.showChromosomeLabels=!0),this.config.orientation||(e="vertical",this.config.orientation=e),this.config.chrHeight||(r=this.config.container,i=document.querySelector(r).getBoundingClientRect(),n="vertical"===e?i.height:i.width,"body"===r&&(n=400),this.config.chrHeight=n),this.config.chrWidth||(o=10,n=this.config.chrHeight,n<900&&n>500?o=Math.round(n/40):n>=900&&(o=Math.round(n/45)),this.config.chrWidth=o),this.config.chrMargin||(1===this.config.ploidy?this.config.chrMargin=10:this.config.chrMargin=Math.round(this.config.chrWidth/4)),this.config.showBandLabels||(this.config.showBandLabels=!1),"showFullyBanded"in this.config?this.config.showFullyBanded=this.config.showFullyBanded:this.config.showFullyBanded=!0,this.config.brush||(this.config.brush=!1),this.config.rows||(this.config.rows=1),this.bump=Math.round(this.config.chrHeight/125),this.adjustedBump=!1,this.config.chrHeight<200&&(this.adjustedBump=!0,this.bump=4),t.showBandLabels&&(this.config.chrMargin+=20),t.chromosome&&(this.config.chromosomes=[t.chromosome],"showBandLabels"in t==!1&&(this.config.showBandLabels=!0),"rotatable"in t==!1&&(this.config.rotatable=!1)),this.config.showNonNuclearChromosomes||(this.config.showNonNuclearChromosomes=!1),this.initAnnotSettings(),this.config.chrMargin=this.config.chrMargin+this.config.chrWidth+2*this.config.annotTracksHeight,t.onLoad&&(this.onLoadCallback=t.onLoad),t.onDrawAnnots&&(this.onDrawAnnotsCallback=t.onDrawAnnots),t.onBrushMove&&(this.onBrushMoveCallback=t.onBrushMove),this.coordinateSystem="iscn",this.maxLength={bp:0,iscn:0},this.eutils="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/",this.esearch=this.eutils+"esearch.fcgi?retmode=json",this.esummary=this.eutils+"esummary.fcgi?retmode=json",this.elink=this.eutils+"elink.fcgi?retmode=json",this.organisms={9606:{commonName:"Human",scientificName:"Homo sapiens",scientificNameAbbr:"H. sapiens",assemblies:{default:"GCF_000001405.26",GRCh38:"GCF_000001405.26",GRCh37:"GCF_000001405.13"}},10090:{commonName:"Mouse",scientificName:"Mus musculus",scientificNameAbbr:"M. musculus",assemblies:{default:"GCF_000001635.20"}},4641:{commonName:"banana",scientificName:"Musa acuminata",scientificNameAbbr:"M. acuminata",assemblies:{default:"mock"}}},this.chromosomesArray=[],this.bandsToShow=[],this.chromosomes={},this.numChromosomes=0,this.bandData={},this.init()}return _createClass(Ideogram,[{key:"getBands",value:function getBands(content,taxid,chromosomes){var lines={},delimiter,tsvLines,columns,line,stain,chr,i,init,tsvLinesLength,source,start,stop,firstColumn,tmp;if("chrBands"===content.slice(0,8)&&(source="native"),chromosomes instanceof Array&&"object"===_typeof(chromosomes[0])){for(tmp=[],i=0;i<chromosomes.length;i++)tmp.push(chromosomes[i].name);chromosomes=tmp}if("undefined"==typeof chrBands&&"native"!==source?(delimiter=/\t/,tsvLines=content.split(/\r\n|\n/),init=1):(delimiter=/ /,tsvLines="native"===source?eval(content):content,init=0),firstColumn=tsvLines[0].split(delimiter)[0],source="#chromosome"===firstColumn?"ncbi":"#chrom"===firstColumn?"ucsc":"native",tsvLinesLength=tsvLines.length,"ncbi"===source||"native"===source)for(i=init;i<tsvLinesLength;i++)columns=tsvLines[i].split(delimiter),chr=columns[0],void 0!==chromosomes&&chromosomes.indexOf(chr)===-1||(chr in lines==!1&&(lines[chr]=[]),stain=columns[7],columns[8]&&(stain+=columns[8]),line={chr:chr,bp:{start:parseInt(columns[5],10),stop:parseInt(columns[6],10)},iscn:{start:parseInt(columns[3],10),stop:parseInt(columns[4],10)},px:{start:-1,stop:-1,width:-1},name:columns[1]+columns[2],stain:stain,taxid:taxid},lines[chr].push(line));else if("ucsc"===source)for(i=init;i<tsvLinesLength;i++)columns=tsvLines[i].split(delimiter),columns[0]==="chr"+chromosomeName&&(stain=columns[4],"n/a"===stain&&(stain="gpos100"),start=parseInt(columns[1],10),stop=parseInt(columns[2],10),line={chr:columns[0].split("chr")[1],bp:{start:start,stop:stop},iscn:{start:start,stop:stop},px:{start:-1,stop:-1,width:-1},name:columns[3],stain:stain,taxid:taxid},lines[chr].push(line));return lines}},{key:"getChromosomeModel",value:function(t,e,o,n){var r,i,s,a,c,l,u={},h=this.config.chrHeight,d=this.maxLength;if(c=this.coordinateSystem,l=void 0!==t,l?(u.name=e,u.length=t[t.length-1][c].stop,u.type="nuclear"):u=e,u.chrIndex=n,u.id="chr"+u.name+"-"+o,this.config.fullChromosomeLabels===!0){var f=this.organisms[o].scientificNameAbbr;u.name=f+" chr"+u.name}if(a=u.length,s=0,l)for(var m=0;m<t.length;m++){r=t[m];var g=r[c].stop-r[c].start;i=h*u.length/d[c]*g/a,t[m].px={start:s,stop:s+i,width:i},s=t[m].px.stop,l&&"acen"===r.stain&&"p"===r.name[0]&&(u.pcenIndex=m)}else s=h*u.length/d[c];return u.width=s,u.scale={},this.config.multiorganism===!0?(u.scale.bp=1,u.scale.iscn=h*a/d.bp):(u.scale.bp=h/d.bp,l&&(u.scale.iscn=h/d.iscn)),u.bands=t,u.centromerePosition="",l&&"p"===t[0].name[0]&&"q"===t[1].name[0]&&t[0].bp.stop-t[0].bp.start<2e6&&(u.centromerePosition="telocentric",u.bands=u.bands.slice(1)),l&&1===u.bands.length&&delete u.bands,u}},{key:"drawChromosomeLabels",value:function(){var t=this,e=t._layout.getChromosomeLabelClass(),o=t._layout.getChromosomeSetLabelXPosition(),n=t._layout.getChromosomeSetLabelTranslate();_d2.default.selectAll(t.selector+" .chromosome-set-container").append("text").data(t.chromosomesArray).attr("class","chromosome-set-label "+e).attr("transform",n).attr("x",o).attr("y",function(e,o){return t._layout.getChromosomeSetLabelYPosition(o)}).attr("text-anchor",t._layout.getChromosomeSetLabelAnchor()).each(function(e,o){var n;n=e.name.indexOf(" ")===-1?[e.name]:e.name.match(/^(.*)\s+([^\s]+)$/).slice(1).reverse(),"sex"in t.config&&2===t.config.ploidy&&o===t.sexChromosomes.index&&(n="male"===t.config.sex?["XY"]:["XX"]),_d2.default.select(this).selectAll("tspan").data(n).enter().append("tspan").attr("dy",function(t,e){return e*-1.2+"em"}).attr("x",t._layout.getChromosomeSetLabelXPosition()).attr("class",function(e,o){var n=t.config.fullChromosomeLabels;return 1===o&&n?"italic":null}).text(String)});var r=t._layout.getChromosomeSetLabelTranslate();_d2.default.selectAll(t.selector+" .chromosome-set-container").each(function(e,o){_d2.default.select(this).selectAll(".chromosome").append("text").attr("class","chrLabel").attr("transform",r).attr("x",function(e,o){return t._layout.getChromosomeLabelXPosition(o)}).attr("y",function(e,o){return t._layout.getChromosomeLabelYPosition(o)}).text(function(e,n){return t._ploidy.getAncestor(o,n)}).attr("text-anchor","middle")})}},{key:"drawBandLabels",value:function(t){var e,o,n,r,i,s;i=this,n=[];for(r in t)for(o in t[r])n.push(t[r][o]);var a={};for(chrIndex=0,e=0;e<n.length;e++)chrIndex+=1,s=n[e],o=_d2.default.select(i.selector+" #"+s.id),a[s.id]=[],o.selectAll("text").data(s.bands).enter().append("g").attr("class",function(t,e){return"bandLabel bsbsl-"+e}).attr("transform",function(t){var o=i._layout.getChromosomeBandLabelTranslate(t,e),n=o.x;return a[s.id].push(n+13),o.translate}).append("text").attr("text-anchor",i._layout.getChromosomeBandLabelAnchor(e)).text(function(t){return t.name}),o.selectAll("line.bandLabelStalk").data(s.bands).enter().append("g").attr("class",function(t,e){return"bandLabelStalk bsbsl-"+e}).attr("transform",function(t){var e,o;return e=i.round(t.px.start+t.px.width/2),a[s.id].push(e+13),o=-10,"translate("+e+","+o+")"}).append("line").attr("x1",0).attr("y1",function(){return i._layout.getChromosomeBandTickY1(e)}).attr("x2",0).attr("y2",function(){return i._layout.getChromosomeBandTickY2(e)});for(e=0;e<n.length;e++){s=n[e];var c,l,u,h,d,f,m=a[s.id].length,g=[];for(c=0,f=5,l=0;l<m;l++)h=a[s.id][l],h<c+f==!1?(g.push(l),u!==l&&(prevTextBoxLeft=a[s.id][l],prevTextBoxWidth=36,d=prevTextBoxLeft+prevTextBoxWidth),h<d+f?(u=l,c=d):g.push(l)):(u=l,c=d);var p,y=[],_=g.length;for(p=0;p<_;p++)l=g[p],y.push("#"+s.id+" .bsbsl-"+l);this.bandsToShow=this.bandsToShow.concat(y)}}},{key:"rotateChromosomeLabels",value:function(t,e,o,n){var r,i,s,a,c,l,u,h;if(i=this.config.chrWidth,r=this.config.chrMargin*e,l=this.config.numAnnotTracks,s=this,void 0===n||!n.hasOwnProperty("x")||1===n.x&&1===n.y?(a=-8,c=-16,n={x:1,y:1},u=""):(u="scale("+n.x+","+n.y+")",a=-6,c=""===n?-16:-14),"vertical"===o||""===o){var d=e-1;(l>1||""===o)&&(d-=1),chrMargin2=-4,s.config.showBandLabels===!0&&(chrMargin2=s.config.chrMargin+i+26),r=s.config.chrMargin*d,l>1==!1&&(r+=1),c=r+chrMargin2,t.selectAll("text.chrLabel").attr("transform",u).selectAll("tspan").attr("x",a).attr("y",c)}else e-=1,chrMargin2=-i-2,s.config.showBandLabels===!0&&(chrMargin2=s.config.chrMargin+8),h=s.config.annotTracksHeight,"overlay"!==s.config.annotationsLayout&&(h*=2),r=s.config.chrMargin*e,a=3-(r+chrMargin2)+h,a/=n.x,t.selectAll("text.chrLabel").attr("transform","rotate(-90)"+u).selectAll("tspan").attr("x",a).attr("y",c)}},{key:"rotateBandLabels",value:function(t,e,o){var n,r,i,s,a=this;s=t.selectAll(".bandLabel"),chrWidth=this.config.chrWidth,n=this.config.chrMargin*e,i=t.attr("data-orientation"),void 0===o?(o={x:1,y:1},r=""):r="scale("+o.x+","+o.y+")",1===e&&"perspective"in this.config&&"comparative"===this.config.perspective?s.attr("transform",function(t){var e,o;return e=8-n-26,o=a.round(2+t.px.start+t.px.width/2),"rotate(-90)translate("+e+","+o+")"}).selectAll("text").attr("text-anchor","end"):"vertical"===i?s.attr("transform",function(t){var e,o;return e=8-n,o=a.round(2+t.px.start+t.px.width/2),"rotate(-90)translate("+e+","+o+")"}).selectAll("text").attr("transform",r):(s.attr("transform",function(t){var e,r;return e=a.round(-8*o.x+t.px.start+t.px.width/2),r=n-10,"translate("+e+","+r+")"}).selectAll("text").attr("transform",r),t.selectAll(".bandLabelStalk line").attr("transform",r))}},{key:"round",value:function(t){return Math.round(100*t)/100}},{key:"drawChromosome",value:function(t,e,o,n){var r=this.config.chrMargin,i=ModelAdapter.getInstance(t),s=o.append("g").attr("id",t.id).attr("class","chromosome "+i.getCssClass()).attr("transform","translate(0, "+n*r+")");return Chromosome.getInstance(i,this.config,this).render(s,e,n)}},{key:"rotateAndToggleDisplay",value:function(t){if(this.config.taxid){var e=Number(_d2.default.select(t.parentNode).attr("data-set-number")),o=Array.prototype.slice.call(_d2.default.select(t.parentNode).selectAll("g.chromosome")._groups[0]).indexOf(t);return this._layout.rotate(e,o,t)}}},{key:"convertBpToPx",value:function(t,e){var o,n,r,i,s,a,c,l,u,h,d,f,m;for(o=0;o<t.bands.length;o++)if(n=t.bands[o],s=this._bandsXOffset,d=n.bp.start,f=n.bp.stop,m=f-d,l=n.iscn.start,u=n.iscn.stop,h=u-l,a=n.px.start,c=n.px.width,e>=d&&e<=f)return r=h/m,i=l+(e-d)*r,s+a+c*(i-l)/h;throw new Error("Base pair out of range.  bp: "+e+"; length of chr"+t.name+": "+n.bp.stop)}},{key:"convertPxToBp",value:function(t,e){var o,n,r,i,s,a,c,l,u,h;for(o=0;o<t.bands.length;o++)if(n=t.bands[o],s=n.px.start,a=n.px.stop,c=n.iscn.start,l=n.iscn.stop,e>=s&&e<=a)return h=l-c,pxLength=a-s,u=n.bp.stop-n.bp.start,r=h/pxLength,i=c+(e-s)*r,bp=n.bp.start+u*(i-c)/h,Math.round(bp);throw new Error("Pixel out of range.  px: "+bp+"; length of chr"+t.name+": "+a)}},{key:"drawSynteny",value:function(t){var e,o,n,r,i,s,a,c=(new Date).getTime(),l=this;for(n=_d2.default.select(l.selector).insert("g",":first-child").attr("class","synteny"),r=0;r<t.length;r++){regions=t[r],e=regions.r1,o=regions.r2,i="#CFC","color"in regions&&(i=regions.color),s=1,"opacity"in regions&&(s=regions.opacity),e.startPx=this.convertBpToPx(e.chr,e.start),e.stopPx=this.convertBpToPx(e.chr,e.stop),o.startPx=this.convertBpToPx(o.chr,o.start),o.stopPx=this.convertBpToPx(o.chr,o.stop),a=e.chr.id+"_"+e.start+"_"+e.stop+"___"+o.chr.id+"_"+o.start+"_"+o.stop,syntenicRegion=n.append("g").attr("class","syntenicRegion").attr("id",a).on("click",function(){var t=this,e=_d2.default.selectAll(l.selector+" .syntenicRegion").filter(function(){return this!==t});e.classed("hidden",!e.classed("hidden"))}).on("mouseover",function(){var t=this;_d2.default.selectAll(l.selector+" .syntenicRegion").filter(function(){return this!==t}).classed("ghost",!0)}).on("mouseout",function(){_d2.default.selectAll(l.selector+" .syntenicRegion").classed("ghost",!1)});var u=l.config.chrWidth,h=this._layout.getChromosomeSetYTranslate(0),d=this._layout.getChromosomeSetYTranslate(1)-u;syntenicRegion.append("polygon").attr("points",h+", "+e.startPx+" "+h+", "+e.stopPx+" "+d+", "+o.stopPx+" "+d+", "+o.startPx).attr("style","fill: "+i+"; fill-opacity: "+s),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",h).attr("x2",d).attr("y1",e.startPx).attr("y2",o.startPx),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",h).attr("x2",d).attr("y1",e.stopPx).attr("y2",o.stopPx)}var f=(new Date).getTime();l.debug&&console.log("Time in drawSyntenicRegions: "+(f-c)+" ms")}},{key:"initAnnotSettings",value:function(){if(this.config.annotationsPath||this.config.localAnnotationsPath||this.annots||this.config.annotations){if(!this.config.annotationHeight){var t=Math.round(this.config.chrHeight/100);this.config.annotationHeight=t}this.config.annotationTracks?this.config.numAnnotTracks=this.config.annotationTracks.length:this.config.numAnnotTracks=1,this.config.annotTracksHeight=this.config.annotationHeight*this.config.numAnnotTracks,void 0===this.config.barWidth&&(this.config.barWidth=3)}else this.config.annotTracksHeight=0;void 0===this.config.annotationsColor&&(this.config.annotationsColor="#F00")}},{key:"drawAnnots",value:function(t){var e,o,n,r,i,s,a=this,c=[],l=a.chromosomes[a.config.taxid];if("annots"in t[0])return a.drawProcessedAnnots(t);for(s in l)c.push({chr:s,annots:[]});for(e=0;e<t.length;e++)for(n=t[e],o=0;o<c.length;o++)if(n.chr===c[o].chr){r=[n.name,n.start,n.stop-n.start],"color"in n&&r.push(n.color),"shape"in n&&r.push(n.shape),c[o].annots.push(r);break}i=["name","start","length"],"color"in t[0]&&i.push("color"),"shape"in t[0]&&i.push("shape"),a.rawAnnots={keys:i,annots:c},a.annots=a.processAnnotData(a.rawAnnots),a.drawProcessedAnnots(a.annots)}},{key:"processAnnotData",value:function(t){var e,o,n,r,i,s,a,c,l,u,h,d,f,m=this;for(e=t.keys,t=t.annots,i=[],o=0;o<t.length;o++)for(s=t[o],i.push({chr:s.chr,annots:[]}),n=0;n<s.annots.length;n++){a=s.chr,l=s.annots[n],r={};for(var g=0;g<e.length;g++)r[e[g]]=l[g];r.stop=r.start+r.length,c=m.chromosomes[m.config.taxid][a],u=m.convertBpToPx(c,r.start),h=m.convertBpToPx(c,r.stop),d=Math.round((u+h)/2)-28,f=m.config.annotationsColor,m.config.annotationTracks?(r.trackIndex=l[3],f=m.config.annotationTracks[r.trackIndex].color):r.trackIndex=0,"color"in r&&(f=r.color),r.chr=a,r.chrIndex=o,r.px=d,r.startPx=u-30,r.stopPx=h-30,r.color=f,i[o].annots.push(r)}return i}},{key:"getHistogramBars",value:function(t){var e,o,n,r,i,s,a,c,l,u,h,d,f,m,g,p,y,_,b=(new Date).getTime(),v=!1,x=this;h=[],g=x.config.barWidth,r=x.chromosomes[x.config.taxid],y=x.config.annotationsColor,_="histogramScaling"in x.config?x.config.histogramScaling:"relative",void 0===x.maxAnnotsPerBar&&(x.maxAnnotsPerBar={},v=!0);for(n in r){for(chrModel=r[n],l=chrModel.chrIndex,lastBand=chrModel.bands[chrModel.bands.length-1],i=lastBand.px.stop,numBins=Math.round(i/g),d={chr:n,annots:[]},e=0;e<numBins;e++)s=e*g-x.bump,bp=x.convertPxToBp(chrModel,s+x.bump),d.annots.push({bp:bp,px:s-x.bump,count:0,chrIndex:l,chrName:n,color:y,annots:[]});h.push(d)}for(n in t)for(a=t[n].annots,c=t[n].chr,chrModel=r[c],l=chrModel.chrIndex-1,barAnnots=h[l].annots,e=0;e<a.length;e++)for(u=a[e],s=u.px-x.bump,o=0;o<barAnnots.length;o++)if(f=barAnnots[o].px,m=f+g,o===barAnnots.length-1&&(m+=g),s>=f&&s<m){h[l].annots[o].count+=1,h[l].annots[o].annots.push(u);break}if(v===!0||"relative"===_){for(p=0,e=0;e<h.length;e++)for(t=h[e].annots,o=0;o<t.length;o++)barCount=t[o].count,barCount>p&&(p=barCount);x.maxAnnotsPerBar[n]=p}for(e=0;e<h.length;e++)for(t=h[e].annots,o=0;o<t.length;o++)barCount=t[o].count,height=barCount/x.maxAnnotsPerBar[n]*x.config.chrMargin,h[e].annots[o].height=height;var C=(new Date).getTime();return x.debug&&console.log("Time spent in getHistogramBars: "+(C-b)+" ms"),x.bars=h,h}},{key:"fillAnnots",value:function(t){var e,o,n,r,i,s,a;for(e=[],o=[],n=this.chromosomesArray,r=0;r<n.length;r++)i=n[r].name,o.push(i),e.push({chr:i,annots:[]});for(r=0;r<t.length;r++)s=t[r],(a=o.indexOf(s.chr))!==-1&&(e[a]=s);return e}},{key:"drawProcessedAnnots",value:function(t){var e,o,n,r,i,s,a,c,l,u,h,d,f=this;chrMargin=this.config.chrMargin,e=this.config.chrWidth,o="tracks",this.config.annotationsLayout&&(o=this.config.annotationsLayout),"histogram"===o&&(t=f.getHistogramBars(t)),n=f.config.annotationHeight,r="l -"+n+" "+2*n+" l "+2*n+" 0 z",s=n,i="m -"+s+", "+s+"a "+s+","+s+" 0 1,0 "+2*s+",0a "+s+","+s+" 0 1,0 -"+2*s+",0",d=f.fillAnnots(t),a=_d2.default.selectAll(f.selector+" .chromosome").data(d).selectAll("path.annot").data(function(t){return t.annots}).enter(),"tracks"===o?a.append("g").attr("id",function(t){return t.id}).attr("class","annot").attr("transform",function(t){var e=f.config.chrWidth+t.trackIndex*n*2;return"translate("+t.px+","+e+")"}).append("path").attr("d",function(t){return t.shape&&"triangle"!==t.shape?"circle"===t.shape?i:void 0:"m0,0"+r}).attr("fill",function(t){return t.color}):"overlay"===o?a.append("polygon").attr("id",function(t){return t.id}).attr("class","annot").attr("points",function(t){return t.stopPx-t.startPx>1?(c=t.startPx,l=t.stopPx):(c=t.px-.5,l=t.px+.5),u=e,h=0,c+","+u+" "+l+","+u+" "+l+","+h+" "+c+","+h}).attr("fill",function(t){return t.color}):"histogram"===o&&a.append("polygon").attr("zclass","annot").attr("points",function(t){c=t.px+f.bump,l=t.px+f.config.barWidth+f.bump,u=e,h=e+t.height;var o=f.chromosomesArray[t.chrIndex-1].width;return l>o&&(l=o),c+","+u+" "+l+","+u+" "+l+","+h+" "+c+","+h}).attr("fill",function(t){return t.color}),f.onDrawAnnotsCallback&&f.onDrawAnnotsCallback()}},{key:"onBrushMove",value:function(){call(this.onBrushMoveCallback)}},{key:"createBrush",value:function(t,e){function o(){var t=_d2.default.event.selection.map(h.invert),e=Math.floor(t[0]),o=Math.ceil(t[1]);i.selectedRegion={from:e,to:o,extent:o-e},i.onBrushMove&&i.onBrushMoveCallback()}var n,r,i=this,s=i.config.chrWidth+6.5,a=i.config.chrHeight,c=i.chromosomesArray[0],l=c.bands[c.bands.length-1].bp.stop,u=this._layout.getMargin().left,h=_d2.default.scaleLinear().domain([0,_d2.default.max(c.bands,function(t){return t.bp.stop})]).range([u,_d2.default.max(c.bands,function(t){return t.px.stop})+u]);void 0===t&&(t=Math.floor(l/10)),"undefined"==typeof right&&(e=Math.ceil(2*t)),n=i.convertBpToPx(c,t),r=i.convertBpToPx(c,e),i.selectedRegion={from:t,to:e,extent:e-t},i.brush=_d2.default.brushX().extent([[u,0],[a+u,s]]).on("brush",o);var d=this._layout.getChromosomeSetYTranslate(0),f=d+(i.config.chrWidth-s)/2;_d2.default.select(i.selector).append("g").attr("class","brush").attr("transform","translate(0, "+f+")").call(i.brush).call(i.brush.move,[n,r])}},{key:"onLoad",value:function(){call(this.onLoadCallback)}},{key:"onDrawAnnots",value:function(){call(this.onDrawAnnotsCallback)}},{key:"getBandColorGradients",value:function(){var t,e,o,n,r,i,s="";t=[["gneg","#FFF","#FFF","#DDD"],["gpos25","#C8C8C8","#DDD","#BBB"],["gpos33","#BBB","#BBB","#AAA"],["gpos50","#999","#AAA","#888"],["gpos66","#888","#888","#666"],["gpos75","#777","#777","#444"],["gpos100","#444","#666","#000"],["acen","#FEE","#FEE","#FDD"],["noBands","#BBB","#BBB","#AAA"]];for(var a=0;a<t.length;a++)e=t[a][0],o=t[a][1],n=t[a][2],r=t[a][3],s+='<linearGradient id="'+e+'" x1="0%" y1="0%" x2="0%" y2="100%">',s+="gneg"===e?'<stop offset="70%" stop-color="'+n+'" /><stop offset="95%" stop-color="'+r+'" /><stop offset="100%" stop-color="'+o+'" />':'<stop offset="5%" stop-color="'+o+'" /><stop offset="15%" stop-color="'+n+'" /><stop offset="60%" stop-color="'+r+'" />',s+="</linearGradient>";return s+='<pattern id="stalk" width="2" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(30 0 0)"><rect x="0" y="0" width="10" height="2" fill="#CCE" /> <line x1="0" y1="0" x2="0" y2="100%" style="stroke:#88B; stroke-width:0.7;" /></pattern><pattern id="gvar" width="2" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(-30 0 0)"><rect x="0" y="0" width="10" height="2" fill="#DDF" /> <line x1="0" y1="0" x2="0" y2="100%" style="stroke:#99C; stroke-width:0.7;" /></pattern>',s="<defs>"+s+"</defs>",i='<style>.gneg {fill: url("#gneg")} .gpos25 {fill: url("#gpos25")} .gpos33 {fill: url("#gpos33")} .gpos50 {fill: url("#gpos50")} .gpos66 {fill: url("#gpos66")} .gpos75 {fill: url("#gpos75")} .gpos100 {fill: url("#gpos100")} .gpos {fill: url("#gpos100")} .acen {fill: url("#acen")} .stalk {fill: url("#stalk")} .gvar {fill: url("#gvar")} .noBands {fill: url("#noBands")} .chromosome {fill: url("#noBands")} </style>',s=i+s}},{key:"getTaxidFromEutils",value:function(t){var e,o,n,r=this;e=r.config.organism,o=r.esearch+"&db=taxonomy&term="+e,_d2.default.json(o,function(e){return n=e.esearchresult.idlist[0],t(n)})}},{key:"getTaxids",value:function getTaxids(callback){var ideo=this,taxid,taxids,org,orgs,i,taxidInit,tmpChrs,assembly,chromosomes,multiorganism;if(taxidInit="taxid"in ideo.config,ideo.config.multiorganism="organism"in ideo.config&&ideo.config.organism instanceof Array||taxidInit&&ideo.config.taxid instanceof Array,multiorganism=ideo.config.multiorganism,"organism"in ideo.config){for(orgs=multiorganism?ideo.config.organism:[ideo.config.organism],taxids=[],tmpChrs={},i=0;i<orgs.length;i++){org=orgs[i];for(taxid in ideo.organisms)ideo.organisms[taxid].commonName.toLowerCase()===org&&(taxids.push(taxid),multiorganism&&(tmpChrs[taxid]=ideo.config.chromosomes[org]))}0===taxids.length?(promise=new Promise(function(t){ideo.getTaxidFromEutils(t)}),promise.then(function(data){var organism=ideo.config.organism,dataDir=ideo.config.dataDir,urlOrg=organism.replace(" ","-");taxid=data,taxids.push(taxid),ideo.config.taxids=taxids,ideo.organisms[taxid]={commonName:"",scientificName:ideo.config.organism,scientificNameAbbr:""};var fullyBandedTaxids=["9606","10090","10116"];fullyBandedTaxids.indexOf(taxid)!==-1&&ideo.config.showFullyBanded===!1&&(urlOrg+="-no-bands");var chromosomesUrl=dataDir+urlOrg+".js",promise=new Promise(function(t,e){_d2.default.request(chromosomesUrl).get(function(o,n){o&&e(Error(o)),t(n)})});return promise.then(function(data){var asmAndChrArray=[],chromosomes=[],seenChrs={},chr;eval(data.response),asmAndChrArray.push("");for(var i=0;i<chrBands.length;i++)(chr=chrBands[i].split(" ")[0])in seenChrs||(chromosomes.push({name:chr,type:"nuclear"}),seenChrs[chr]=1);return chromsomes=chromosomes.sort(ideo.sortChromosomes),asmAndChrArray.push(chromosomes),ideo.coordinateSystem="iscn",asmAndChrArray},function(){return new Promise(function(t){ideo.coordinateSystem="bp",ideo.getAssemblyAndChromosomesFromEutils(t)})})}).then(function(t){assembly=t[0],chromosomes=t[1],ideo.config.chromosomes=chromosomes,ideo.organisms[taxid].assemblies={default:assembly},callback(taxids)})):(ideo.config.taxids=taxids,multiorganism&&(ideo.config.chromosomes=tmpChrs),callback(taxids))}else multiorganism?(ideo.coordinateSystem="bp",taxidInit&&(taxids=ideo.config.taxid)):(taxidInit&&(taxids=[ideo.config.taxid]),ideo.config.taxids=taxids),callback(taxids)}},{key:"sortChromosomes",value:function(t,e){var o="nuclear"===t.type,n="nuclear"===e.type,r="chloroplast"===t.type,i="chloroplast"===e.type,s="mitochondrion"===t.type,a="mitochondrion"===e.type;return o&&n?naturalSort(t.name,e.name):!o&&n?1:s&&i?1:r&&a?-1:s||r||!a&&!i?void 0:-1}},{key:"getAssemblyAndChromosomesFromEutils",value:function(t){var e,o,n,r,i,s,a,c,l,u,h,d,f,m,g,p,y,_=this;organism=_.config.organism,e=[],n=[],r=_.esearch+"&db=assembly&term=%22"+organism+"%22[organism]AND%20(%22latest%20refseq%22[filter])%20AND%20(%22chromosome%20level%22[filter]%20OR%20%22complete%20genome%22[filter])",_d2.default.promise.json(r).then(function(t){return i=t.esearchresult.idlist[0],s=_.esummary+"&db=assembly&id="+i,_d2.default.promise.json(s)}).then(function(t){a=t.result[i].rsuid,o=t.result[i].assemblyaccession,e.push(o);var n="&db=nuccore&linkname=gencoll_nuccore_chr&from_uid="+a;return c=_.elink+n,_d2.default.promise.json(c)}).then(function(t){return l=t.linksets[0].linksetdbs[0].links.join(","),u=_.esummary+"&db=nucleotide&id="+l,_d2.default.promise.json(u)}).then(function(o){h=o.result;for(var r in h)if(d=h[r],"uids"!==r){if("mitochondrion"===d.genome){if(!_.config.showNonNuclearChromosomes)continue;y=d.genome,f=d.subtype.split("|").indexOf("plasmid"),m=f===-1?"MT":d.subname.split("|")[f]}else if("chloroplast"===d.genome||"plastid"===d.genome){if(y="chloroplast",!_.config.showNonNuclearChromosomes)continue;m="CP"}else y="nuclear",f=d.subtype.split("|").indexOf("chromosome"),void 0!==(m=d.subname.split("|")[f])&&"chr"===m.substr(0,3)&&(m=m.substr(3));g=d.slen,p={name:m,length:g,type:y},n.push(p)}return n=n.sort(_.sortChromosomes),e.push(n),_.coordinateSystem="bp",t(e)})}},{key:"drawSexChromosomes",
value:function(t,e,o,n,r,i){var s,a,c,l,u,h,d,f=this;for(d="male"===f.config.sex?[1,0]:[0,0],h=0;h<d.length;h++)u=d[h]+r,s=i[u],a=t[u],c=f.getChromosomeModel(a,s,e,u),l=f.drawChromosome(c,r,o,h),n.append("clipPath").attr("id",c.id+"-chromosome-set-clippath").selectAll("path").data(l).enter().append("path").attr("d",function(t){return t.path}).attr("class",function(t){return t.class})}},{key:"initDrawChromosomes",value:function(t){var e,o,n,r,i,s,a,c,l,u=this,h=u.config.taxids,d=u.config.ploidy,f=0,m=0;for(c=_d2.default.select(u.selector+" defs"),n=0;n<h.length;n++){for(e=h[n],i=u.config.chromosomes[e],u.chromosomes[e]={},u.setSexChromosomes(i),r=0;r<i.length;r++)if(s=i[r],o=t[f],f+=1,a=u.getChromosomeModel(o,s,e,f),u.chromosomes[e][s]=a,u.chromosomesArray.push(a),!("sex"in u.config&&(2===d&&u.sexChromosomes.index+2===f||"female"===u.config.sex&&"Y"===a.name))){l=u._layout.getChromosomeSetTranslate(m),m+=1;var g=_d2.default.select(u.selector).append("g").attr("class","chromosome-set-container").attr("data-set-number",r).attr("transform",l).attr("id",a.id+"-chromosome-set");if("sex"in u.config&&2===d&&u.sexChromosomes.index+1===f)u.drawSexChromosomes(t,e,g,c,r,i);else{var p,y=1;d>1&&(y=this._ploidy.getChromosomesNumber(r));for(var _=0;_<y;_++)p=u.drawChromosome(a,f-1,g,_);c.append("clipPath").attr("id",a.id+"-chromosome-set-clippath").selectAll("path").data(p).enter().append("path").attr("d",function(t){return t.path}).attr("class",function(t){return t.class})}}u.config.showBandLabels===!0&&u.drawBandLabels(u.chromosomes)}}},{key:"getSvg",value:function(){return _d2.default.select(this.selector).node()}},{key:"setSexChromosomes",value:function(t){if(2===this.config.ploidy&&this.config.sex){var e,o,n=this,r={X:1,Y:1};for(n.sexChromosomes.list=[],o=0;o<t.length;o++)e=t[o],"male"===n.config.sex&&e in r?(n.sexChromosomes.list.push(e),n.sexChromosomes.index||(n.sexChromosomes.index=o)):"X"===e&&(n.sexChromosomes.list.push(e,e),n.sexChromosomes.index=o)}}},{key:"processBandData",value:function(){var t,e,o,n,r,s,a,c,l,u,h,d,f,m=this;if(t=[],maxLength=0,m.config.multiorganism===!0)for(m.coordinateSystem="bp",h=m.config.taxids,i=0;i<h.length;i++)u=h[i];else void 0===m.config.taxid&&(m.config.taxid=m.config.taxids[0]),u=m.config.taxid,h=[u],m.config.taxids=h;"chromosomes"in m.config&&(d=m.config.chromosomes),m.config.multiorganism&&(f=d),m.config.chromosomes={};var g=(new Date).getTime();for(e=0;e<h.length;e++)if(u=h[e],m.config.multiorganism&&(d=f[u]),"iscn"===m.coordinateSystem||m.config.multiorganism)for(c=m.bandData[u],l=m.getBands(c,u,d),d=Object.keys(l).sort(function(t,e){return naturalSort(t,e)}),m.config.chromosomes[u]=d.slice(),m.numChromosomes+=m.config.chromosomes[u].length,o=0;o<d.length;o++)n=d[o],r=l[n],t.push(r),s={iscn:r[r.length-1].iscn.stop,bp:r[r.length-1].bp.stop},s.iscn>m.maxLength.iscn&&(m.maxLength.iscn=s.iscn),s.bp>m.maxLength.bp&&(m.maxLength.bp=s.bp);else if("bp"===m.coordinateSystem)for(m.config.chromosomes[u]=d.slice(),m.numChromosomes+=m.config.chromosomes[u].length,o=0;o<d.length;o++)a=d[o],a.length>m.maxLength.bp&&(m.maxLength.bp=a.length);var p=(new Date).getTime();return m.debug&&console.log("Time in processBandData: "+(p-g)+" ms"),t}},{key:"init",value:function init(){function writeContainer(){if(ideo.config.annotationsPath&&_d2.default.json(ideo.config.annotationsPath,function(t){ideo.rawAnnots=t}),"ploidyDesc"in ideo.config&&"string"==typeof ideo.config.ploidyDesc){for(var t=[],e=0;e<ideo.numChromosomes;e++)t.push(ideo.config.ploidyDesc);ideo.config.ploidyDesc=t}ideo._ploidy=new Ploidy(ideo.config),ideo._layout=Layout.getInstance(ideo.config,ideo),svgClass="",ideo.config.showChromosomeLabels&&("horizontal"===ideo.config.orientation?svgClass+="labeledLeft ":svgClass+="labeled "),ideo.config.annotationsLayout&&"overlay"===ideo.config.annotationsLayout&&(svgClass+="faint");var o=ideo.getBandColorGradients(),n=ideo._layout.getWidth(taxid),r=ideo._layout.getHeight(taxid);_d2.default.select(ideo.config.container).append("div").append("svg").attr("id","_ideogram").attr("class",svgClass).attr("width",n).attr("height",r).html(o),finishInit()}function finishInit(){try{var t,e=(new Date).getTime();if(ideo.initDrawChromosomes(bandsArray),ideo.config.annotationsPath){var o=function(){void 0!==ideo.timeout&&window.clearTimeout(ideo.timeout),ideo.annots=ideo.processAnnotData(ideo.rawAnnots),ideo.drawProcessedAnnots(ideo.annots),"undefined"!=typeof crossfilter&&ideo.initCrossFilter&&ideo.initCrossFilter()};ideo.rawAnnots?o():function t(){ideo.timeout=setTimeout(function(){ideo.rawAnnots?o():t()},50)}()}if(ideo.config.showBandLabels===!0){var n=ideo.bandsToShow.join(","),r=(new Date).getTime();_d2.default.selectAll(ideo.selector+" .bandLabel, .bandLabelStalk").style("display","none"),_d2.default.selectAll(n).style("display","");var i=(new Date).getTime();if(ideo.debug&&console.log("Time in showing bands: "+(i-r)+" ms"),"vertical"===ideo.config.orientation){var s;for(t=0;t<ideo.chromosomesArray.length;t++)s="#"+ideo.chromosomesArray[t].id,ideo.rotateChromosomeLabels(_d2.default.select(s),t)}}ideo.config.showChromosomeLabels===!0&&ideo.drawChromosomeLabels(ideo.chromosomes),ideo.config.brush===!0&&ideo.createBrush(),ideo.config.annotations&&ideo.drawAnnots(ideo.config.annotations);var a=(new Date).getTime();ideo.debug&&console.log("Time in drawChromosome: "+(a-e)+" ms");var c=(new Date).getTime();ideo.debug&&console.log("Time constructing ideogram: "+(c-t0)+" ms"),ideo.onLoadCallback&&ideo.onLoadCallback(),"rotatable"in ideo.config&&ideo.config.rotatable===!1?_d2.default.selectAll(ideo.selector+" .chromosome").style("cursor","default"):_d2.default.selectAll(ideo.selector+" .chromosome").on("click",function(){ideo.rotateAndToggleDisplay(this)})}catch(t){throw t}}var taxid,i,svgClass,ideo=this,t0=(new Date).getTime(),bandsArray=[],numBandDataResponses=0,resolution=this.config.resolution,accession,promise=new Promise(function(t){ideo.getTaxids(t)});promise.then(function(taxids){taxid=taxids[0],ideo.config.taxid=taxid,ideo.config.taxids=taxids;var assemblies,bandFileName,bandDataFileNames={9606:"",10090:""};for(i=0;i<taxids.length;i++)taxid=String(taxids[i]),ideo.config.assembly||(ideo.config.assembly="default"),assemblies=ideo.organisms[taxid].assemblies,accession=assemblies[ideo.config.assembly],bandFileName=[],bandFileName.push(slugify(ideo.organisms[taxid].scientificName)),accession!==assemblies.default&&bandFileName.push(accession),"9606"!==taxid||accession===assemblies.default&&850===resolution||bandFileName.push(resolution),bandFileName=bandFileName.join("-")+".js","9606"!==taxid&&"10090"!==taxid||(bandDataFileNames[taxid]=bandFileName),"undefined"==typeof chrBands&&taxid in bandDataFileNames?_d2.default.request(ideo.config.dataDir+bandDataFileNames[taxid]).on("beforesend",function(t){t.taxid=taxid}).get(function(error,data){eval(data.response),ideo.bandData[data.taxid]=chrBands,(numBandDataResponses+=1)===taxids.length&&(bandsArray=ideo.processBandData(),writeContainer())}):("undefined"!=typeof chrBands&&(ideo.bandData[taxid]=chrBands),bandsArray=ideo.processBandData(),writeContainer())})}}]),Ideogram}();Ideogram.prototype.unpackAnnots=function(){var t,e,o,n=[],r=this,i=r.annots;for(o=0;o<i.length;o++)t=i[o],e=t.annots,n=n.concat(e);return n},Ideogram.prototype.packAnnots=function(t){var e,o,n,r=[],i=this,s=i.annots;for(e in s)r.push({chr:s[e].chr,annots:[]});for(n=0;n<t.length;n++)o=t[n],r[o.chrIndex].annots.push(o);return r},Ideogram.prototype.initCrossFilter=function(){var t,e,o=this,n=o.rawAnnots.keys;for(o.unpackedAnnots=o.unpackAnnots(),o.crossfilter=crossfilter(o.unpackedAnnots),o.annotsByFacet={},o.facets=n.slice(3,n.length),t=0;t<o.facets.length;t++)e=o.facets[t],o.annotsByFacet[e]=o.crossfilter.dimension(function(t){return t[e]})},Ideogram.prototype.filterAnnots=function(t){var e,o,n,r,i=Date.now(),s={},a=this;if(0===Object.keys(t).length)n=a.unpackedAnnots;else{for(e=0;e<a.facets.length;e++)o=a.facets[e],r=o in t?function(e){if(e in t[o])return!0}:null,a.annotsByFacet[o].filter(r),s[o]=a.annotsByFacet[o].group().top(1/0);n=a.annotsByFacet[o].top(1/0)}for(e<0;e<a.facets.length;e++)a.annotsByFacet[o].filterAll();return n=a.packAnnots(n),d3.selectAll(a.selector+" polygon.annot").remove(),a.drawAnnots(n),console.log("Time in filterAnnots: "+(Date.now()-i)+" ms"),s},ChromosomeUtil.prototype.getLabel=function(){return d3.select(this._node).select("text.chrLabel").text()},ChromosomeUtil.prototype.getSetLabel=function(){return d3.select(this._node.parentNode).select("text.chromosome-set-label").text()};
//# sourceMappingURL=ideogram.min.js.map
