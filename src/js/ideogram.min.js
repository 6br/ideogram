(function(){function f(){return function(){process.nextTick(g)}}function c(){return function(){J(g)}}function b(){var a=0,b=new T(g),d=document.createTextNode("");return b.observe(d,{characterData:!0}),function(){d.data=a=++a%2}}function a(){var a=new MessageChannel;return a.port1.onmessage=g,function(){a.port2.postMessage(0)}}function e(){return function(){setTimeout(g,1)}}function g(){for(var a=0;x>a;a+=2)(0,D[a])(D[a+1]),D[a]=void 0,D[a+1]=void 0;x=0}function h(){try{var a=require("vertx");return J=
a.runOnLoop||a.runOnContext,c()}catch(b){return e()}}function d(){}function k(a){try{return a.then}catch(b){return K.error=b,K}}function l(a,b,d,e){try{a.call(b,d,e)}catch(c){return c}}function m(a,b,d){y(function(a){var e=!1,c=l(d,b,function(d){e||(e=!0,b!==d?r(a,d):v(a,d))},function(b){e||(e=!0,t(a,b))},"Settle: "+(a._label||" unknown promise"));!e&&c&&(e=!0,t(a,c))},a)}function n(a,b){b._state===G?v(a,b._result):b._state===E?t(a,b._result):w(b,void 0,function(b){r(a,b)},function(b){t(a,b)})}function p(a,
b,d){b.constructor===a.constructor&&d===O&&constructor.resolve===P?n(a,b):d===K?t(a,K.error):void 0===d?v(a,b):"function"==typeof d?m(a,b,d):v(a,b)}function r(a,b){a===b?t(a,new TypeError("You cannot resolve a promise with itself")):"function"==typeof b||"object"==typeof b&&null!==b?p(a,b,k(b)):v(a,b)}function z(a){a._onerror&&a._onerror(a._result);Q(a)}function v(a,b){a._state===F&&(a._result=b,a._state=G,0!==a._subscribers.length&&y(Q,a))}function t(a,b){a._state===F&&(a._state=E,a._result=b,y(z,
a))}function w(a,b,d,e){var c=a._subscribers,f=c.length;a._onerror=null;c[f]=b;c[f+G]=d;c[f+E]=e;0===f&&a._state&&y(Q,a)}function Q(a){var b=a._subscribers,d=a._state;if(0!==b.length){for(var e,c,f=a._result,g=0;g<b.length;g+=3)e=b[g],c=b[g+d],e?U(d,e,c,f):c(f);a._subscribers.length=0}}function V(){this.error=null}function U(a,b,d,e){var c,f,g,h,k="function"==typeof d;if(k){var l;try{l=d(e)}catch(p){l=(R.error=p,R)}if(c=l,c===R?(h=!0,f=c.error,c=null):g=!0,b===c)return void t(b,new TypeError("A promises callback cannot return that same promise."))}else c=
e,g=!0;b._state!==F||(k&&g?r(b,c):h?t(b,f):a===G?v(b,c):a===E&&t(b,c))}function X(a,b){try{b(function(b){r(a,b)},function(b){t(a,b)})}catch(d){t(a,d)}}function A(a){a[L]=W++;a._state=void 0;a._result=void 0;a._subscribers=[]}function u(a){this[L]=W++;this._result=this._state=void 0;this._subscribers=[];if(d!==a){if("function"!=typeof a)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof u)X(this,a);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}}function B(a,b){this._instanceConstructor=a;this.promise=new a(d);this.promise[L]||A(this.promise);M(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=Array(this.length),0===this.length?v(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&v(this.promise,this._result))):t(this.promise,Error("Array Methods must be provided an Array"))}var J,H,I,M=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},
x=0,y=function(a,b){D[x]=a;D[x+1]=b;x+=2;2===x&&(H?H(g):I())},C="undefined"!=typeof window?window:void 0,N=C||{},T=N.MutationObserver||N.WebKitMutationObserver,N="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Y="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,D=Array(1E3);I=N?f():T?b():Y?a():void 0===C&&"function"==typeof require?h():e();var O=function(a,b){var c=this,e=new this.constructor(d);
void 0===e[L]&&A(e);var f=c._state;if(f){var g=arguments[f-1];y(function(){U(f,e,g,c._result)})}else w(c,e,a,b);return e},P=function(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=new this(d);return r(b,a),b},L=Math.random().toString(36).substring(16),F=void 0,G=1,E=2,K=new V,R=new V,W=0;u.all=function(a){return(new Z(this,a)).promise};u.race=function(a){var b=this;return new b(M(a)?function(d,c){for(var e=a.length,f=0;e>f;f++)b.resolve(a[f]).then(d,c)}:function(a,b){b(new TypeError("You must pass an array to race."))})};
u.resolve=P;u.reject=function(a){var b=new this(d);return t(b,a),b};u._setScheduler=function(a){H=a};u._setAsap=function(a){y=a};u._asap=y;u.prototype={constructor:u,then:O,"catch":function(a){return this.then(null,a)}};var Z=B;B.prototype._enumerate=function(){for(var a=this.length,b=this._input,d=0;this._state===F&&a>d;d++)this._eachEntry(b[d],d)};B.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,e=c.resolve;e===P?(e=k(a),e===O&&a._state!==F?this._settledAt(a._state,b,a._result):
"function"!=typeof e?(this._remaining--,this._result[b]=a):c===u?(c=new c(d),p(c,a,e),this._willSettleAt(c,b)):this._willSettleAt(new c(function(b){b(a)}),b)):this._willSettleAt(e(a),b)};B.prototype._settledAt=function(a,b,d){var c=this.promise;c._state===F&&(this._remaining--,a===E?t(c,d):this._result[b]=d);0===this._remaining&&v(c,this._result)};B.prototype._willSettleAt=function(a,b){var d=this;w(a,void 0,function(a){d._settledAt(G,b,a)},function(a){d._settledAt(E,b,a)})};var C=function(){var a;
if("undefined"!=typeof global)a=global;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw Error("polyfill failed because global object is unavailable in this environment");}var d=a.Promise;d&&"[object Promise]"===Object.prototype.toString.call(d.resolve())&&!d.cast||(a.Promise=u)},S={Promise:u,polyfill:C};"function"==typeof define&&define.amd?define(function(){return S}):"undefined"!=typeof module&&module.exports?module.exports=S:"undefined"!=typeof this&&
(this.ES6Promise=S);C()}).call(this);
!function(f,c){"function"==typeof define&&define.amd?define(["d3"],c):"object"==typeof exports?module.exports=c(require("d3")):f.d3.promise=c(f.d3)}(this,function(f){var c=function(){function b(a,b){return function(){var c=Array.prototype.slice.call(arguments);return new Promise(function(d,f){b.apply(a,c.concat(function(a,b){return a?void f(Error(a)):void d(b)}))})}}var a={};return"csv tsv json xml text html".split(" ").forEach(function(c){a[c]=b(f,f[c])}),a}();return f.promise=c,c});
function naturalSort(f,c){var b,a,e=/(^([+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|^0x[\da-fA-F]+$|\d+)/g,g=/^\s+|\s+$/g,h=/\s+/g,d=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,k=/^0x[0-9a-f]+$/i,l=/^0/,m=function(a){return(naturalSort.insensitive&&(""+a).toLowerCase()||""+a).replace(g,"")},n=m(f),p=m(c),m=n.replace(e,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),e=p.replace(e,"\x00$1\x00").replace(/\0$/,
"").replace(/^\0/,"").split("\x00"),n=parseInt(n.match(k),16)||1!==m.length&&Date.parse(n),k=parseInt(p.match(k),16)||n&&p.match(d)&&Date.parse(p)||null,d=function(a,b){return(!a.match(l)||1==b)&&parseFloat(a)||a.replace(h," ").replace(g,"")||0};if(k){if(n<k)return-1;if(n>k)return 1}for(var k=0,n=m.length,p=e.length,r=Math.max(n,p);k<r;k++){if(b=d(m[k]||"",n),a=d(e[k]||"",p),isNaN(b)!==isNaN(a))return isNaN(b)?1:-1;if(/[^\x00-\x80]/.test(b+a)&&b.localeCompare)return b=b.localeCompare(a),b/Math.abs(b);
if(b<a)return-1;if(b>a)return 1}}
var Ideogram=function(f){this.config=JSON.parse(JSON.stringify(f));this.debug=!1;this.config.dataDir||(this.config.dataDir="data/");this.config.bandDir||(this.config.bandDir=this.config.dataDir+"bands/");this.config.container||(this.config.container="body");this.config.resolution||(this.config.resolution=850);!1==="showChromosomeLabels"in this.config&&(this.config.showChromosomeLabels=!0);this.config.chrMargin||(this.config.chrMargin=10);if(!this.config.orientation){var c="vertical";this.config.orientation=
c}if(!this.config.chrHeight){var b=this.config.container,a=document.querySelector(b).getBoundingClientRect(),c="vertical"===c?a.height:a.width;"body"==b&&(c=500);this.config.chrHeight=c}this.config.chrWidth||(b=10,c=this.config.chrHeight,900>c&&500<c?b=Math.round(c/40):900<=c&&(b=Math.round(c/45)),this.config.chrWidth=b);this.config.showBandLabels||(this.config.showBandLabels=!1);this.config.brush||(this.config.brush=!1);this.config.rows||(this.config.rows=1);this.bump=Math.round(this.config.chrHeight/
125);this.adjustedBump=!1;200>this.config.chrHeight&&(this.adjustedBump=!0,this.bump=4);f.showBandLabels&&(this.config.chrMargin+=20);f.chromosome&&(this.config.chromosomes=[f.chromosome],!1==="showBandLabels"in f&&(this.config.showBandLabels=!0),!1==="rotatable"in f&&(this.config.rotatable=!1));this.config.showNonNuclearChromosomes||(this.config.showNonNuclearChromosomes=!1);this.config.showCentromeres||(this.config.showCentromeres=!0);this.config.armColors&&(this.config.showCentromeres=!1);this.initAnnotSettings();
this.config.chrMargin=this.config.chrMargin+this.config.chrWidth+2*this.config.annotTracksHeight;f.onLoad&&(this.onLoadCallback=f.onLoad);f.onDrawAnnots&&(this.onDrawAnnotsCallback=f.onDrawAnnots);f.onBrushMove&&(this.onBrushMoveCallback=f.onBrushMove);this.coordinateSystem="iscn";this.maxLength={bp:0,iscn:0};this.esearch="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?retmode=json";this.esummary="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?retmode=json";this.elink="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?retmode=json";
this.organisms={9606:{commonName:"Human",scientificName:"Homo sapiens",scientificNameAbbr:"H. sapiens",assemblies:{"default":"GCF_000001305.14",GRCh38:"GCF_000001305.14",GRCh37:"GCF_000001305.13"}},10090:{commonName:"Mouse",scientificName:"Mus musculus",scientificNameAbbr:"M. musculus",assemblies:{"default":"GCF_000000055.19"}},7227:{commonName:"Fly",scientificName:"Drosophlia melanogaster",scientificNameAbbr:"D. melanogaster"}};this.chromosomesArray=[];this.bandsToShow=[];this.chromosomes={};this.numChromosomes=
0;this.bandData={};this.init()};
Ideogram.prototype.getBands=function(f,c,b){var a={},e,g,h,d,k,l,m;"chrBands"===f.slice(0,8)&&(g="native");"undefined"===typeof chrBands&&"native"!==g?(e=/\t/,f=f.split(/\r\n|\n/),k=1):(e=/ /,f="native"===g?eval(f):f,k=0);l=f[0].split(e)[0];g="#chromosome"==l?"ncbi":"#chrom"==l?"ucsc":"native";l=f.length;if("ncbi"===g||"native"===g)for(;k<l;k++){if(g=f[k].split(e),d=g[0],"undefined"===typeof b||-1!==b.indexOf(d))!1===d in a&&(a[d]=[]),h=g[7],g[8]&&(h+=g[8]),g={chr:d,bp:{start:parseInt(g[5],10),stop:parseInt(g[6],
10)},iscn:{start:parseInt(g[3],10),stop:parseInt(g[4],10)},px:{start:-1,stop:-1,width:-1},name:g[1]+g[2],stain:h,taxid:c},a[d].push(g)}else if("ucsc"===g)for(;k<l;k++)g=f[k].split(e),g[0]==="chr"+chromosomeName&&(h=g[4],"n/a"===h&&(h="gpos100"),b=parseInt(g[1],10),m=parseInt(g[2],10),g={chr:g[0].split("chr")[1],bp:{start:b,stop:m},iscn:{start:b,stop:m},px:{start:-1,stop:-1,width:-1},name:g[3],stain:h,taxid:c},a[d].push(g));return a};
Ideogram.prototype.colorArms=function(f,c){var b=this;b.chromosomesArray.forEach(function(a,e){var g=a.centromere[1],h=a.id,d=b.config.chrMargin*(e+1),k=b.config.chrWidth;pcenStart=a.centromere[0].px.start;qcenStop=g.px.stop;d3.select("#"+h).append("line").attr("x1",pcenStart).attr("y1",d+.2).attr("x2",pcenStart).attr("y2",d+k-.2).style("stroke",f);d3.select("#"+h).append("line").attr("x1",qcenStop).attr("y1",d+.2).attr("x2",qcenStop).attr("y2",d+k-.2).style("stroke",c);d3.selectAll("#"+h+" .band").data(a.bands).style("fill",
function(b,d){return d<=a.pcenIndex-1?f:c});d3.selectAll("#"+h+" .acen").data(a.centromere).style("fill",function(a,b){return"p"==a.name[0]?f:c})});d3.selectAll(".upstream.chromosomeBorder").style("fill",f);d3.selectAll(".downstream.chromosomeBorder").style("fill",c)};
Ideogram.prototype.getCentromereModel=function(f){var c,b=f.centromere.start,a=Math.ceil(f.centromere.length/2),e;c=[{bp:{start:b,length:a}},{bp:{start:b+a,length:a}}];"pcenBandName"in f.centromere?(c[0].name=f.centromere.pcenBandName,c[1].name=f.centromere.qcenBandName):(c[0].name="p11",c[1].name="q11");"iscnStart"in f.centromere?(e="iscn",b=f.centromere.iscnStart,a=Math.ceil(f.centromere.iscnLength/2),c[0].iscn={start:b,length:a},c[0].px=f.centromere.pcenPx,c[1].iscn={start:b,length:b+a},c[1].px=
f.centromere.qcenPx):e="bp";if("bp"==e)for(b=0;b<c.length;b++)e=c[b],a=e.bp.start,e=a+e.bp.length,a=this.convertBpToPxNoBands(f,a),e=this.convertBpToPxNoBands(f,e),c[b].px={start:a,stop:e,width:e-a};cenWidthPx=c[1].px.stop-c[0].px.start;this.bump>cenWidthPx&&(c[0].px={start:c[0].px.start-this.bump,stop:c[0].px.stop,width:c[0].px.width+this.bump},c[1].px={start:c[1].px.start,stop:c[1].px.stop+this.bump,width:c[1].px.width+this.bump});return c};
Ideogram.prototype.getChromosomeModel=function(f,c,b,a){var e={},g,h=this.config.chrHeight,d=this.maxLength,k=this.bump,l,m;l=this.coordinateSystem;(m="undefined"!==typeof f)?(e.name=c,e.length=f[f.length-1][l].stop,e.type="nuclear"):e=c;e.chrIndex=a;e.id="chr"+e.name+"-"+b;!0===this.config.fullChromosomeLabels&&(e.name=this.organisms[b].scientificNameAbbr+" chr"+e.name);b=e.length;c=0;if(m){for(var n=0;n<f.length;n++)a=f[n],g=h*e.length/d[l]*(a[l].stop-a[l].start)/b,f[n].px={start:c,stop:c+g,width:g},
c=f[n].px.stop,"acen"===a.stain&&"p"===a.name[0]&&(e.pcenIndex=n);"pcenIndex"in e&&(a=e.pcenIndex,l=f[a],a=f[a+1],n=l.px,g=a.px,this.adjustedBump&&n.width+g.width>k&&(n.stop=n.stop+(k/2-n.width)-.3,n.width=k/2,g.stop=g.stop+(k/2-g.width)-.3,g.width=k/2),e.centromere={start:l.bp.start,length:a.bp.stop-l.bp.start,iscnStart:l.iscn.start,iscnLength:a.iscn.stop-l.iscn.start,pcenPx:n,qcenPx:g,pcenBandName:l.name,qcenBandName:a.name})}else c=h*e.length/d[l];e.width=c;e.scale={};!0===this.config.multiorganism?
(e.scale.bp=1,e.scale.iscn=h*b/d.bp):(e.scale.bp=h/d.bp,m&&(e.scale.iscn=h/d.iscn));m&&(e.bands=f);e.centromerePosition="";m&&1==f[0].bp.stop-f[0].bp.start&&(e.centromerePosition="telocentricPCen",e.bands=e.bands.slice(1));if("centromere"in e){e.centromere=this.getCentromereModel(e);for(n=0;n<e.centromere.length;n++)a=e.centromere[n],f=a.bp.start,h=f+a.bp.length,"p"==a.name[0]&&1==f?e.centromerePosition="telocentricPCen":"q"==a.name[0]&&h==e.length-1&&(e.centromerePosition="telocentricQCen");""==
e.centromerePosition&&e.centromere[0].px.start<2*this.bump&&(e.centromerePosition="telocentricPCen");"9606"==this.config.taxid&&(e.centromerePosition="")}f=this.getCenAndArmParameters(e);e.pcenStart=f[0];e.qArmStart=f[1];e.qArmWidth=f[2];e.qArmEnd=f[3];return e};
Ideogram.prototype.drawChromosomeLabels=function(f){var c,b;c=this;var a=c.config.chrMargin,e=c.config.chrWidth;f=c.chromosomesArray;b=e/2+a-8;"vertical"===c.config.orientation&&!0===c.config.showBandLabels&&(b=a+17);"vertical"===c.config.orientation?d3.selectAll(".chromosome").append("text").data(f).attr("class","chrLabel").attr("transform","rotate(-90)").attr("y",-16).each(function(f,h){var d,k;d=f.name.split(" ");var l=[];if(void 0!=d)for(l.push(d.slice(0,d.length-1).join(" ")),l.push(d[d.length-
1]),c.config.showBandLabels||(h+=1),d=a*h,d=-(d+b-e-2)+2*c.config.annotTracksHeight,h=0;h<l.length;h++)k="",0==h&&c.config.fullChromosomeLabels&&(k="italic"),d3.select(this).append("tspan").text(l[h]).attr("dy",h?"1.2em":0).attr("x",d).attr("text-anchor","middle").attr("class",k)}):d3.selectAll(".chromosome").append("text").data(f).attr("class","chrLabel").attr("x",-5).each(function(e,f){var d,k;d=e.name.split(" ");var l=[];if(void 0!=d)for(l.push(d.slice(0,d.length-1).join(" ")),l.push(d[d.length-
1]),d=a*f,d+=b,f=0;f<l.length;f++)k="",0==f&&c.config.fullChromosomeLabels&&(k="italic"),d3.select(this).append("tspan").text(l[f]).attr("dy",f?"1.2em":0).attr("y",d).attr("x",-8).attr("text-anchor","middle").attr("class",k)})};
Ideogram.prototype.drawBandLabels=function(f){var c,b,a,e,g;e=this;b=[];for(a in f)for(c in f[a])b.push(f[a][c]);var h={};for(f=chrIndex=0;f<b.length;f++){chrIndex+=1;g=b[f];c=d3.select("#"+g.id);var d=this.config.chrMargin*chrIndex,k;e=this;k=d;1==chrIndex&&"perspective"in this.config&&"comparative"==this.config.perspective&&(k+=18);h[g.id]=[];c.selectAll("text").data(g.bands).enter().append("g").attr("class",function(a,b){return"bandLabel bsbsl-"+b}).attr("transform",function(a){a=e.round(-8+a.px.start+
a.px.width/2);h[g.id].push(a+13);return"translate("+a+","+(d-10)+")"}).append("text").text(function(a){return a.name});c.selectAll("line.bandLabelStalk").data(g.bands).enter().append("g").attr("class",function(a,b){return"bandLabelStalk bsbsl-"+b}).attr("transform",function(a){return"translate("+e.round(a.px.start+a.px.width/2)+", "+k+")"}).append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",-8)}for(f=0;f<b.length;f++){g=b[f];var l=h[g.id].length,m;a=[];var n,p,r;for(c=m=0;c<l;c++)p=h[g.id][c],
!1===p<m+5?(a.push(c),n!==c&&(prevTextBoxLeft=h[g.id][c],prevTextBoxWidth=36,r=prevTextBoxLeft+prevTextBoxWidth),p<r+5?(n=c,m=r):a.push(c)):(n=c,m=r);l=[];m=a.length;for(p=0;p<m;p++)c=a[p],l.push("#"+g.id+" .bsbsl-"+c);this.bandsToShow=this.bandsToShow.concat(l)}};
Ideogram.prototype.rotateChromosomeLabels=function(f,c,b,a){var e,g,h,d,k,l,m,n;g=this.config.chrWidth;e=this.config.chrMargin*c;l=this.config.numAnnotTracks;h=this;"undefined"===typeof a||!a.hasOwnProperty("x")||1==a.x&&1==a.y?(d=-8,k=-16,a={x:1,y:1},m=""):(m="scale("+a.x+","+a.y+")",d=-6,k=""===a?-16:-14);"vertical"==b||""==b?f.selectAll("text.chrLabel").attr("transform",m).selectAll("tspan").attr("x",d).attr("y",function(a,d){var e=c-1;(1<l||""==b)&&--e;chrMargin2=-4;!0===h.config.showBandLabels&&
(chrMargin2=h.config.chrMargin+g+26);e*=h.config.chrMargin;0==1<l&&(e+=1);return e+chrMargin2}):(--c,chrMargin2=-g-2,!0===h.config.showBandLabels&&(chrMargin2=h.config.chrMargin+8),n=h.config.annotTracksHeight,"overlay"!==h.config.annotationsLayout&&(n*=2),f.selectAll("text.chrLabel").attr("transform","rotate(-90)"+m).selectAll("tspan").attr("x",function(b,f){e=h.config.chrMargin*c;d=-(e+chrMargin2)+3+n;return d/=a.x}).attr("y",k))};
Ideogram.prototype.rotateBandLabels=function(f,c,b){var a,e,g,h,d=this;h=f.selectAll(".bandLabel");a=this.config.chrMargin*c;g=f.attr("data-orientation");"undefined"==typeof b?(b={x:1,y:1},e=""):e="scale("+b.x+","+b.y+")";1==c&&"perspective"in this.config&&"comparative"==this.config.perspective?h.attr("transform",function(b){var c;c=8-a-26;b=d.round(2+b.px.start+b.px.width/2);return"rotate(-90)translate("+c+","+b+")"}).selectAll("text").attr("text-anchor","end"):"vertical"==g?h.attr("transform",function(b){var c;
c=8-a;b=d.round(2+b.px.start+b.px.width/2);return"rotate(-90)translate("+c+","+b+")"}).selectAll("text").attr("transform",e):(h.attr("transform",function(c){return"translate("+d.round(-8*b.x+c.px.start+c.px.width/2)+","+(a-10)+")"}).selectAll("text").attr("transform",e),f.selectAll(".bandLabelStalk line").attr("transform",e))};Ideogram.prototype.round=function(f){return Math.round(100*f)/100};
Ideogram.prototype.getCentromerePath=function(f,c){var b=this.round(f.px.start),a=this.round(f.px.width),e=this.bump,g="bands"in c,h=this.config.chrWidth,d=this.config.chrMargin*c.chrIndex,k,l;l=0;this.adjustedBump&&(l=.35,a=.2,b+=e,"q"===f.name[0]&&(b-=.7));d+=l;k=h/2-2*l;h-=2*l;g?(mx=b,my=d,ldx=a-e/2,q=e+" "+k+" 0 "+h+" "):(mx=b-a,my=d,ldx=a+0,q=e+1+" "+k+" 0 "+h+" ");this.adjustedBump&&(ldx=.2);"p"==f.name[0]?f="M "+mx+" "+my+" l "+ldx+" 0 q "+q+"l -"+ldx+" 0 z":(this.adjustedBump&&(a-=.2),"telocentricPCen"==
c.centromerePosition&&(mx+=1),g?(mx=b+a,q=e+.5+" "+k+" 0 "+h+" "):mx=mx+(e+1)+ldx,f="M "+mx+" "+my+" l -"+ldx+" 0 q -"+q+"l "+ldx+" 0 z");return f};
Ideogram.prototype.getCenAndArmParameters=function(f){var c=this.bump,b,a,e,g,h,d,k;b=f.centromere;a=f.centromerePosition;"telocentricPCen"!==a&&"centromere"in f?(g=b[0],h=b[1],e=g.px.width-c/2,b=g.px.start,g=h.px.stop+c/2-e):(b=2,g=6);d=f.width-g;k=g+d-c/2;"telocentricPCen"!==a&&("bands"in f?g=h.px.stop:(b-=e,k+=c/2));this.adjustedBump&&(k-=1.8*1.3);return[b,g,d,k]};
Ideogram.prototype.drawChromosomeBordersAndCentromeres=function(f,c){var b=this.bump,a,e,g,h,d,k;a=this.config.chrMargin*f.chrIndex;e=this.config.chrWidth;g=f.centromere;h=f.centromerePosition;pcenStart=f.pcenStart;qArmStart=f.qArmStart;qArmWidth=f.qArmWidth;qArmEnd=f.qArmEnd;if(g&&"telocentricPCen"!=h)for(var l=0;l<g.length;l++)band=g[l],"p"==band.name[0]&&"telocentricPCen"==h||"q"==band.name[0]&&"telocentricQCen"==h||(d=this.getCentromerePath(band,f),k=f.id+"-"+band.name,c.append("path").attr("id",
k).attr("class",band.name+" acen band").attr("d",d));else g=Math.round(b/4)+3,d="","bands"in f&&(d=f.bands[0].stain),c.append("path").attr("class","upstream chromosomeBorder "+d).attr("d","M "+(g-3)+" "+a+" l -"+(g-2)+" 0 l 0 "+e+" l "+(g-2)+" 0 z"),c.insert("path",":first-child").attr("class","acen").attr("d","M "+(g-3)+" "+(a+.1*e)+" l "+(g+b/2+1)+" 0 l 0 "+.8*e+" l -"+(g+b/2+1)+" 0 z");!1==="bands"in f&&("telocentricPCen"!=h&&c.append("path").attr("class","p-arm chromosomeBody").attr("d","M "+
b/2+" "+a+" l "+(pcenStart-b/2)+" 0 l 0 "+e+" l -"+(pcenStart-b/2)+" 0 z"),"telocentricQCen"==h?qArmEnd+=b:c.append("path").attr("class","q-arm chromosomeBody").attr("d","M "+qArmStart+" "+a+" l "+qArmWidth+" 0 l 0 "+e+" l -"+qArmWidth+" 0 z"));this.drawChromosomeBorders(c,f,b,a,pcenStart,e,qArmStart,qArmEnd)};
Ideogram.prototype.drawChromosomeNoBands=function(f,c){var b,a,e,g,h,d;a=this.bump;e=this.config.chrMargin*c;g=this.config.chrWidth;h=f.width;b=d3.select("svg").append("g").attr("id",f.id).attr("class","chromosome noBands");1>h||(!1==="centromere"in f?(b.append("line").attr("class","cb-top chromosomeBorder").attr("x1",a/2).attr("y1",e).attr("x2",h).attr("y2",e),b.append("line").attr("class","cb-bottom chromosomeBorder").attr("x1",a/2).attr("y1",g+e).attr("x2",h).attr("y2",g+e),b.append("path").attr("class",
"chromosomeBody").attr("d","M "+a/2+" "+e+" l "+(h-a/2)+" 0 l 0 "+g+" l -"+(h-a/2)+" 0 z")):this.drawChromosomeBordersAndCentromeres(f,b),d=f.centromerePosition,"telocentricPCen"!==d&&b.append("path").attr("class","upstream chromosomeBorder").attr("d","M "+(a/2+.1)+" "+e+" q -"+a+" "+g/2+" 0 "+g),"telocentricQCen"!==d&&b.append("path").attr("class","downstream chromosomeBorder").attr("d","M "+h+" "+e+" q "+a+" "+g/2+" 0 "+g))};
Ideogram.prototype.drawChromosomeBorders=function(f,c,b,a,e,g,h,d){var k=c.centromerePosition;this.adjustedBump&&(c=b/2,e+=2*c,h-=c,d+=2*c);"telocentricPCen"!==k&&(f.append("line").attr("class","cb-p-arm-top chromosomeBorder").attr("x1",b/2).attr("y1",a).attr("x2",e).attr("y2",a),f.append("line").attr("class","cb-p-arm-bottom chromosomeBorder").attr("x1",b/2).attr("y1",g+a).attr("x2",e).attr("y2",g+a));"telocentricQCen"!==k&&(f.append("line").attr("class","cb-q-arm-top chromosomeBorder").attr("x1",
h).attr("y1",a).attr("x2",d).attr("y2",a),f.append("line").attr("class","cb-q-arm-bottom chromosomeBorder").attr("x1",h).attr("y1",g+a).attr("x2",d).attr("y2",g+a))};
Ideogram.prototype.drawChromosome=function(f,c){var b,a,e,g,h,d;d=this;if("undefined"===typeof f.bands)d.drawChromosomeNoBands(f,c);else{h=d.bump;g="telocentricPCen"!=f.centromerePosition?h:Math.round(h/4)+3;b=d3.select("svg").append("g").attr("id",f.id).attr("class","chromosome");a=d.config.chrWidth;e=f.width;var k=d.config.chrMargin*c;b.selectAll("path").data(f.bands).enter().append("path").attr("id",function(a){a=a.name.replace(".","-");return f.id+"-"+a}).attr("class",function(a){var b="band "+
a.stain;if("acen"!=a.stain)return b}).attr("d",function(b,c){var e=d.round(b.px.width),p=d.round(b.px.start);if("acen"!=b.stain)return 0==c&&(p+=g-h/2,!0===d.config.multiorganism&&(p+=g)),d.adjustedBump&&"q"===b.name[0]&&(p+=1.8),c==f.bands.length-1&&(p-=g-h/2),b="M "+p+" "+k+" l "+e+" 0 l 0 "+a+" l -"+e+" 0 z"});"telocentricPCen"!=f.centromerePosition&&b.append("path").attr("class","upstream chromosomeBorder "+f.bands[0].stain).attr("d","M "+(g-h/2+.1)+" "+k+" q -"+g+" "+a/2+" 0 "+a);d.drawChromosomeBordersAndCentromeres(f,
b);e-=h/2;d.adjustedBump&&(borderTweak=2,e+=borderTweak-.4);b.append("path").attr("class","downstream chromosomeBorder "+f.bands[f.bands.length-1].stain).attr("d","M "+e+" "+k+" q "+h+" "+a/2+" 0 "+a)}};
Ideogram.prototype.initTransformChromosome=function(f,c){if("vertical"==this.config.orientation){var b,a;a=this.config.chrWidth;b=this.config.chrMargin*c;this.config.showBandLabels||(c+=2);b+=(a-4)*(c-1);f.attr("data-orientation","vertical").attr("transform","rotate(90, "+(b-30)+", "+b+")");this.rotateBandLabels(f,c)}else f.attr("data-orientation","horizontal")};
Ideogram.prototype.rotateAndToggleDisplay=function(f){var c,b,a,e,g,h,d,k,l=this;c=d3.select("#"+f);b=l.chromosomes[l.config.taxid][f.split("-")[0].split("chr")[1]].chrIndex;otherChrs=d3.selectAll("g.chromosome").filter(function(a,b){return this.id!==f});d=l.config.orientation;k=c.attr("data-orientation");a=this.config.chrMargin*b;e=this.config.chrWidth;g=d3.select("#_ideogram").nodes()[0].getBoundingClientRect();h=g.height;g=g.width;"vertical"==d?(chrLength=c.nodes()[0].getBoundingClientRect().height,
h=g/chrLength*.97,scale="scale("+h+", 1.5)",inverseScaleX=2/h,inverseScaleY=1,this.config.showBandLabels||(b+=2),e=a+(e-4)*(b-1)-30,verticalTransform="rotate(90, "+e+", "+(e+30)+")",a=-1.5*(a-this.config.annotTracksHeight),this.config.showBandLabels&&(a+=25),horizontalTransform="rotate(0)translate(20, "+a+")"+scale):(chrLength=c.nodes()[0].getBoundingClientRect().width,h=h/chrLength*.97,scale="scale("+h+", 1.5)",inverseScaleX=2/h,inverseScaleY=1,h=20,this.config.showBandLabels||(b+=2,h=15),e=a+(e-
h)*(b-2),a=e+5,this.config.showBandLabels||(e+=h,a+=h),verticalTransform="rotate(90, "+e+", "+a+")"+scale,horizontalTransform="");inverseScale="scale("+inverseScaleX+","+inverseScaleY+")";"vertical"!=k?("horizontal"==d&&otherChrs.style("display","none"),c.selectAll(".annot>path").attr("transform","vertical"==d?"":inverseScale),c.attr("data-orientation","vertical").transition().attr("transform",verticalTransform).on("end",function(){scale="vertical"==d?"":{x:inverseScaleY,y:inverseScaleX};l.rotateBandLabels(c,
b,scale);l.rotateChromosomeLabels(c,b,"horizontal",scale);"vertical"==d&&otherChrs.style("display","")})):(c.attr("data-orientation",""),"vertical"==d&&otherChrs.style("display","none"),c.selectAll(".annot>path").transition().attr("transform","vertical"==d?inverseScale:""),c.transition().attr("transform",horizontalTransform).on("end",function(){inverseScale="horizontal"==d?"vertical"==k?{x:1,y:1}:"":{x:inverseScaleX,y:inverseScaleY};l.rotateBandLabels(c,b,inverseScale);l.rotateChromosomeLabels(c,
b,"",inverseScale);"horizontal"==d&&otherChrs.style("display","")}))};Ideogram.prototype.convertBpToPxNoBands=function(f,c){return c*f.scale.bp};
Ideogram.prototype.convertBpToPx=function(f,c){var b,a;for(b=0;b<f.bands.length;b++)if(a=f.bands[b],c>=a.bp.start&&c<=a.bp.stop)return b=(a.iscn.stop-a.iscn.start)/(a.bp.stop-a.bp.start),b=a.iscn.start+(c-a.bp.start)*b,a=30+a.px.start+a.px.width*(b-a.iscn.start)/(a.iscn.stop-a.iscn.start);throw Error("Base pair out of range.  bp: "+c+"; length of chr"+f.name+": "+a.bp.stop);};
Ideogram.prototype.convertPxToBp=function(f,c){var b,a;for(b=0;b<f.bands.length;b++)if(a=f.bands[b],c>=a.px.start&&c<=a.px.stop)return pxToIscnScale=(a.iscn.stop-a.iscn.start)/(a.px.stop-a.px.start),b=a.iscn.start+(c-a.px.start)*pxToIscnScale,bp=a.bp.start+(a.bp.stop-a.bp.start)*(b-a.iscn.start)/(a.iscn.stop-a.iscn.start),Math.round(bp);throw Error("Pixel out of range.  px: "+bp+"; length of chr"+f.name+": "+a.px.stop);};
Ideogram.prototype.drawSynteny=function(f){var c=(new Date).getTime(),b,a,e,g,h,d,k,l,m;h=d3.select("svg").insert("g",":first-child").attr("class","synteny");for(d=0;d<f.length;d++)regions=f[d],b=regions.r1,a=regions.r2,k="#CFC","color"in regions&&(k=regions.color),l=1,"opacity"in regions&&(l=regions.opacity),b.startPx=this.convertBpToPx(b.chr,b.start),b.stopPx=this.convertBpToPx(b.chr,b.stop),a.startPx=this.convertBpToPx(a.chr,a.start),a.stopPx=this.convertBpToPx(a.chr,a.stop),e=document.querySelectorAll("#"+
b.chr.id+" path")[0].getBBox(),g=document.querySelectorAll("#"+a.chr.id+" path")[0].getBBox(),e=e.y-31,g=g.y-28,m=b.chr.id+"_"+b.start+"_"+b.stop+"___"+a.chr.id+"_"+a.start+"_"+a.stop,syntenicRegion=h.append("g").attr("class","syntenicRegion").attr("id",m).on("click",function(){var a=this,b=d3.selectAll(".syntenicRegion").filter(function(b,d){return this!==a});b.classed("hidden",!b.classed("hidden"))}).on("mouseover",function(){var a=this;d3.selectAll(".syntenicRegion").filter(function(b,d){return this!==
a}).classed("ghost",!0)}).on("mouseout",function(){d3.selectAll(".syntenicRegion").classed("ghost",!1)}),syntenicRegion.append("polygon").attr("points",e+", "+b.startPx+" "+e+", "+b.stopPx+" "+g+", "+a.stopPx+" "+g+", "+a.startPx).attr("style","fill: "+k+"; fill-opacity: "+l),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",e).attr("x2",g).attr("y1",b.startPx).attr("y2",a.startPx),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",e).attr("x2",g).attr("y1",
b.stopPx).attr("y2",a.stopPx);f=(new Date).getTime();this.debug&&console.log("Time in drawSyntenicRegions: "+(f-c)+" ms")};
Ideogram.prototype.initAnnotSettings=function(){this.config.annotationsPath||this.config.localAnnotationsPath||this.annots||this.config.annotations?(this.config.annotationHeight||(this.config.annotationHeight=Math.round(this.config.chrHeight/100)),this.config.numAnnotTracks=this.config.annotationTracks?this.config.annotationTracks.length:1,this.config.annotTracksHeight=this.config.annotationHeight*this.config.numAnnotTracks,"undefined"===typeof this.config.barWidth&&(this.config.barWidth=3)):this.config.annotTracksHeight=
0;"undefined"===typeof this.config.annotationsColor&&(this.config.annotationsColor="#F00")};
Ideogram.prototype.drawAnnots=function(f){var c,b,a,e=[],g;b=this.chromosomes[this.config.taxid];if("annots"in f[0])return this.drawProcessedAnnots(f);for(c in b)e.push({chr:c,annots:[]});for(c=0;c<f.length;c++)for(a=f[c],b=0;b<e.length;b++)if(a.chr===e[b].chr){g=[a.name,a.start,a.stop-a.start];"color"in a&&g.push(a.color);"shape"in a&&g.push(a.shape);e[b].annots.push(g);break}c=["name","start","length"];"color"in f[0]&&c.push("color");"shape"in f[0]&&c.push("shape");this.rawAnnots={keys:c,annots:e};
this.annots=this.processAnnotData(this.rawAnnots);this.drawProcessedAnnots(this.annots)};
Ideogram.prototype.processAnnotData=function(f){var c=f.keys;f=f.annots;var b,a,e,g,h,d,k,l,m;g=[];for(b=0;b<f.length;b++)for(h=f[b],g.push({chr:h.chr,annots:[]}),a=0;a<h.annots.length;a++){d=h.chr;l=h.annots[a];e={};for(m=0;m<c.length;m++)e[c[m]]=l[m];e.stop=e.start+e.length;k=this.chromosomes["9606"][d];m=this.convertBpToPx(k,e.start);k=this.convertBpToPx(k,e.stop);m=Math.round((m+k)/2)-28;k=this.config.annotationsColor;this.config.annotationTracks?(e.trackIndex=l[3],k=this.config.annotationTracks[e.trackIndex].color):
e.trackIndex=0;"color"in e&&(k=e.color);e.chr=d;e.chrIndex=b;e.px=m;e.color=k;g[b].annots.push(e)}return g};
Ideogram.prototype.getHistogramBars=function(f){var c=(new Date).getTime(),b,a,e,g,h,d,k,l,m,n,p,r,z=!1,v;m=[];r=this.config.barWidth;g=this.chromosomes[this.config.taxid];a=this.config.annotationsColor;v="histogramScaling"in this.config?this.config.histogramScaling:"relative";"undefined"===typeof this.maxAnnotsPerBar&&(this.maxAnnotsPerBar={},z=!0);for(e in g){chrModel=g[e];k=chrModel.chrIndex;lastBand=chrModel.bands[chrModel.bands.length-1];b=lastBand.px.stop;numBins=Math.round(b/r);d={chr:e,annots:[]};
for(b=0;b<numBins;b++)h=b*r-this.bump,bp=this.convertPxToBp(chrModel,h+this.bump),d.annots.push({bp:bp,px:h-this.bump,count:0,chrIndex:k,chrName:e,color:a,annots:[]});m.push(d)}for(e in f)for(d=f[e].annots,b=f[e].chr,chrModel=g[b],k=chrModel.chrIndex-1,barAnnots=m[k].annots,b=0;b<d.length;b++)for(l=d[b],h=l.px-this.bump,a=0;a<barAnnots.length;a++)if(n=barAnnots[a].px,p=n+r,a==barAnnots.length-1&&(p+=r),h>=n&&h<p){m[k].annots[a].count+=1;m[k].annots[a].annots.push(l);break}if(1==z||"relative"==v){for(b=
g=0;b<m.length;b++)for(f=m[b].annots,a=0;a<f.length;a++)barCount=f[a].count,barCount>g&&(g=barCount);this.maxAnnotsPerBar[e]=g}for(b=0;b<m.length;b++)for(f=m[b].annots,a=0;a<f.length;a++)barCount=f[a].count,height=barCount/this.maxAnnotsPerBar[e]*this.config.chrMargin,m[b].annots[a].height=height;f=(new Date).getTime();this.debug&&console.log("Time spent in getHistogramBars: "+(f-c)+" ms");return this.bars=m};
Ideogram.prototype.drawProcessedAnnots=function(f){var c,b,a,e,g,h,d,k,l,m,n=this;c=this.config.chrMargin;b=this.config.chrWidth;a="tracks";this.config.annotationsLayout&&(a=this.config.annotationsLayout);"histogram"===a&&(f=n.getHistogramBars(f));e=n.config.annotationHeight;g="l -"+e+" "+2*e+" l "+2*e+" 0 z";h="m -"+e+", "+e+"a "+e+","+e+" 0 1,0 "+2*e+",0a "+e+","+e+" 0 1,0 -"+2*e+",0";f=d3.selectAll(".chromosome").data(f).selectAll("path.annot").data(function(a){return a.annots}).enter();"tracks"===
a?f.append("g").attr("id",function(a,b){return a.id}).attr("class","annot").attr("transform",function(a){return"translate("+a.px+","+((a.chrIndex+1)*c+b+a.trackIndex*e*2)+")"}).append("path").attr("d",function(a){if(!a.shape||"triangle"===a.shape)return"m0,0"+g;if("circle"===a.shape)return h}).attr("fill",function(a){return a.color}):"overlay"===a?f.append("polygon").attr("id",function(a,b){return a.id}).attr("class","annot").attr("points",function(a){d=a.px-.5;k=a.px+.5;l=(a.chrIndex+1)*c+b;m=(a.chrIndex+
1)*c;return d+","+l+" "+k+","+l+" "+k+","+m+" "+d+","+m}).attr("fill",function(a){return a.color}):"histogram"===a&&f.append("polygon").attr("class","annot").attr("points",function(a){d=a.px+n.bump;k=a.px+n.config.barWidth+n.bump;l=a.chrIndex*c+b;m=a.chrIndex*c+b+a.height;a=n.chromosomesArray[a.chrIndex-1].width;k>a&&(k=a);return d+","+l+" "+k+","+l+" "+k+","+m+" "+d+","+m}).attr("fill",function(a){return a.color});if(n.onDrawAnnotsCallback)n.onDrawAnnotsCallback()};
Ideogram.prototype.putChromosomesInRows=function(){var f=this.config.rows,c,b,a,e,g,h,d;c=Math.floor(this.numChromosomes/f);e=0;"g"!==d3.select("svg > *").nodes()[0].tagName&&(e=2);for(var k=1;k<f;k++)b=c*k+1+e,a=b+c,a="nth-child(n+"+b+"):nth-child(-n+"+a+")",g=this.config.chrHeight+20,b=b+1-e,h=this.config.chrWidth,d=this.config.chrMargin*b,this.config.showBandLabels||(b+=2),this.config.showChromosomeLabels&&(g+=12),rowWidth=(h-4)*b+8+d,d3.selectAll("#_ideogram .chromosome:"+a).attr("transform",
function(a,b){return d3.select(this).attr("transform")+("translate("+g+", "+rowWidth+")")})};Ideogram.prototype.onBrushMove=function(){call(this.onBrushMoveCallback)};
Ideogram.prototype.createBrush=function(f,c){var b=this,a=b.config.chrWidth+6.5,e=b.config.chrHeight,g=b.chromosomesArray[0],h=g.bands[g.bands.length-1].bp.stop,d,k;k=[0];for(var l=[0],m,n=0;n<g.bands.length;n++)m=g.bands[n],k.push(m.bp.stop),l.push(m.px.stop);d=d3.scaleLinear().domain(k).range(l);k=d3.select(".band").nodes()[0].getBBox().y-3.25;"undefined"===typeof f&&(f=Math.floor(h/10));"undefined"===typeof right&&(c=Math.ceil(2*f));h=b.convertBpToPx(g,f);g=b.convertBpToPx(g,c);b.selectedRegion=
{from:f,to:c,extent:c-f};b.brush=d3.brushX().extent([[0,0],[e,a]]).on("brush",function(){var a=d3.event.selection.map(d.invert),c=Math.floor(a[0]),a=Math.ceil(a[1]);b.selectedRegion={from:c,to:a,extent:a-c};if(b.onBrushMove)b.onBrushMoveCallback()});d3.select("#_ideogram").append("g").attr("class","brush").attr("transform","translate(0, "+k+")").call(b.brush).call(b.brush.move,[h,g])};Ideogram.prototype.onLoad=function(){call(this.onLoadCallback)};Ideogram.prototype.onDrawAnnots=function(){call(this.onDrawAnnotsCallback)};
Ideogram.prototype.getBandColorGradients=function(){var f,c,b,a,e,g="";f=[["gneg","#FFF","#FFF","#DDD"],["gpos25","#C8C8C8","#DDD","#BBB"],["gpos33","#BBB","#BBB","#AAA"],["gpos50","#999","#AAA","#888"],["gpos66","#888","#888","#666"],["gpos75","#777","#777","#444"],["gpos100","#444","#666","#000"],["acen","#FEE","#FEE","#FDD"],["noBands","#BBB","#BBB","#AAA"]];for(var h=0;h<f.length;h++)c=f[h][0],b=f[h][1],a=f[h][2],e=f[h][3],g+='<linearGradient id="'+c+'" x1="0%" y1="0%" x2="0%" y2="100%">',g="gneg"==
c?g+('<stop offset="70%" stop-color="'+a+'" /><stop offset="95%" stop-color="'+e+'" /><stop offset="100%" stop-color="'+b+'" />'):g+('<stop offset="5%" stop-color="'+b+'" /><stop offset="15%" stop-color="'+a+'" /><stop offset="60%" stop-color="'+e+'" />'),g+="</linearGradient>";return g='<style>.gneg {fill: url("#gneg")} .gpos25 {fill: url("#gpos25")} .gpos33 {fill: url("#gpos33")} .gpos50 {fill: url("#gpos50")} .gpos66 {fill: url("#gpos66")} .gpos75 {fill: url("#gpos75")} .gpos100 {fill: url("#gpos100")} .acen {fill: url("#acen")} .stalk {fill: url("#stalk")} .gvar {fill: url("#gvar")} .noBands {fill: url("#noBands")} </style>'+
("<defs>"+(g+'<pattern id="stalk" width="2" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(30 0 0)"><rect x="0" y="0" width="10" height="2" fill="#CCE" /> <line x1="0" y1="0" x2="0" y2="100%" style="stroke:#88B; stroke-width:0.7;" /></pattern><pattern id="gvar" width="2" height="1" patternUnits="userSpaceOnUse" patternTransform="rotate(-30 0 0)"><rect x="0" y="0" width="10" height="2" fill="#DDF" /> <line x1="0" y1="0" x2="0" y2="100%" style="stroke:#99C; stroke-width:0.7;" /></pattern>')+
"</defs>")};Ideogram.prototype.getTaxidFromEutils=function(f){var c;d3.json(this.esearch+"&db=taxonomy&term="+this.config.organism,function(b){c=b.esearchresult.idlist[0];return f(c)})};
Ideogram.prototype.getTaxids=function(f){var c=this,b,a,e,g,h,d,k,l,m;e="taxid"in c.config;c.config.multiorganism="organism"in c.config&&c.config.organism instanceof Array||e&&c.config.taxid instanceof Array;m=c.config.multiorganism;if("organism"in c.config){g=m?c.config.organism:[c.config.organism];a=[];d={};for(h=0;h<g.length;h++)for(b in e=g[h],c.organisms)c.organisms[b].commonName.toLowerCase()===e&&(a.push(b),m&&(d[b]=c.config.chromosomes[e]));0==a.length?(promise=new Promise(function(a,b){c.getTaxidFromEutils(a)}),
promise.then(function(d){var e=c.config.organism,f=c.config.dataDir,g=e.replace(" ","-");b=d;a.push(b);c.config.taxids=a;c.organisms[b]={commonName:"",scientificName:e,scientificNameAbbr:""};return d3.promise.json(f+"chromosomes/"+g+".json").then(function(a){var b=[];b.push(a.assemblyaccession);a=a.chromosomes.sort(c.sortChromosomes);b.push(a);c.coordinateSystem="bp";return b},function(a){return new Promise(function(a,b){c.coordinateSystem="bp";c.getAssemblyAndChromosomesFromEutils(a)})})}).then(function(d){k=
d[0];l=d[1];c.config.chromosomes=l;c.organisms[b].assemblies={"default":k};f(a)})):(c.config.taxids=a,m&&(c.config.chromosomes=d),f(a))}else m?(c.coordinateSystem="bp",e&&(a=c.config.taxid)):(e&&(a=[c.config.taxid]),c.config.taxids=a),f(a)};
Ideogram.prototype.sortChromosomes=function(f,c){var b="nuclear"===f.type,a="nuclear"===c.type,e="chloroplast"===f.type,g="chloroplast"===c.type,h="mitochondrion"===f.type,d="mitochondrion"===c.type;if(b&&a)return naturalSort(f.name,c.name);if(!b&&a||h&&g)return 1;if(e&&d||!h&&!e&&(d||g))return-1};
Ideogram.prototype.getAssemblyAndChromosomesFromEutils=function(f){var c,b,a,e,g,h,d,k,l,m,n,p,r,z,v,t,w=this;organism=w.config.organism;c=[];a=[];d3.promise.json(w.esearch+"&db=assembly&term=%22"+organism+"%22[organism]AND%20(%22latest%20refseq%22[filter])%20AND%20(%22chromosome%20level%22[filter]%20OR%20%22complete%20genome%22[filter])").then(function(a){e=a.esearchresult.idlist[0];g=w.esummary+"&db=assembly&id="+e;return d3.promise.json(g)}).then(function(a){h=a.result[e].rsuid;b=a.result[e].assemblyaccession;
c.push(b);d=w.elink+"&db=nuccore&linkname=gencoll_nuccore_chr&from_uid="+h;return d3.promise.json(d)}).then(function(a){k=a.linksets[0].linksetdbs[0].links.join(",");l=w.esummary+"&db=nucleotide&id="+k;return d3.promise.json(l)}).then(function(b){m=b.result;for(var d in m)if(n=m[d],"uids"!==d){if("mitochondrion"===n.genome)if(w.config.showNonNuclearChromosomes)t=n.genome,p=n.subtype.split("|").indexOf("plasmid"),r=-1===p?"MT":n.subname.split("|")[p];else continue;else if("chloroplast"===n.genome||
"plastid"===n.genome)if(t="chloroplast",w.config.showNonNuclearChromosomes)r="CP";else continue;else t="nuclear",p=n.subtype.split("|").indexOf("chromosome"),r=n.subname.split("|")[p],"undefined"!==typeof r&&"chr"===r.substr(0,3)&&(r=r.substr(3));z=n.slen;v={name:r,length:z,type:t};a.push(v)}a=a.sort(w.sortChromosomes);c.push(a);return f(c)})};
Ideogram.prototype.initDrawChromosomes=function(f){var c=this.config.taxids,b,a=0,e,g,h,d,k;tmpChrs=[];for(e=0;e<c.length;e++){b=c[e];h=this.config.chromosomes[b];this.chromosomes[b]={};for(g=0;g<h.length;g++)d=h[g],bands=f[a],a+=1,k=this.getChromosomeModel(bands,d,b,a),this.chromosomes[b][d]=k,this.chromosomesArray.push(k),this.drawChromosome(k,a),"undefined"===typeof bands&&(this.chromosomes[b][d.name]=k,tmpChrs[g]=k.name);"undefined"===typeof bands&&(this.config.chromosomes[b]=tmpChrs);!0===this.config.showBandLabels&&
this.drawBandLabels(this.chromosomes)}};
Ideogram.prototype.init=function(){function f(){d.config.annotationsPath&&d3.json(d.config.annotationsPath,function(a){d.rawAnnots=a});h="";d.config.showChromosomeLabels&&(h="horizontal"==d.config.orientation?h+"labeledLeft ":h+"labeled ");d.config.annotationsLayout&&"overlay"===d.config.annotationsLayout&&(h+="faint");var a;"vertical"===d.config.orientation?(a=d.config.chrHeight+40,1<d.config.rows&&(a=d.config.rows*(a-30))):a=d.config.chrMargin*d.numChromosomes+30;var c=d.getBandColorGradients();
d3.select(d.config.container).append("svg").attr("id","_ideogram").attr("class",h).attr("width","97%").attr("height",a).html(c);b()}function c(){var a,b,c,e,f,h,k,m;l=[];if(!0===d.config.multiorganism)for(d.coordinateSystem="bp",h=d.config.taxids,g=0;g<h.length;g++);else"undefined"==typeof d.config.taxid&&(d.config.taxid=d.config.taxids[0]),e=d.config.taxid,h=[e],d.config.taxids=h;"chromosomes"in d.config&&(k=d.config.chromosomes);d.config.multiorganism&&(m=k);d.config.chromosomes={};var n=(new Date).getTime();
for(c=0;c<h.length;c++)if(e=h[c],d.config.multiorganism&&(k=m[e]),"iscn"===d.coordinateSystem||d.config.multiorganism)for(f=d.bandData[e],f=d.getBands(f,e,k),k=Object.keys(f),d.config.chromosomes[e]=k.slice(),d.numChromosomes+=d.config.chromosomes[e].length,e=0;e<k.length;e++)a=k[e],b=f[a],l.push(b),a=b[b.length-1].iscn.stop,b=b[b.length-1].bp.stop,a>d.maxLength.iscn&&(d.maxLength.iscn=a),b>d.maxLength.bp&&(d.maxLength.bp=b);else if("bp"==d.coordinateSystem)for(d.config.chromosomes[e]=k.slice(),d.numChromosomes+=
d.config.chromosomes[e].length,e=0;e<k.length;e++)f=k[e],f.length>d.maxLength.bp&&(d.maxLength.bp=f.length);c=(new Date).getTime();d.debug&&console.log("Time in processBandData: "+(c-n)+" ms")}function b(){try{var a=(new Date).getTime(),b=0,c,f,g,h,m,n,p,A;d.initDrawChromosomes(l);c=d.config.taxids;for(p=b=0;p<c.length;p++)for(e=c[p],g=d.config.chromosomes[e],A=0;A<g.length;A++)b+=1,m=g[A],h=d.chromosomes[e][m],f=d3.select("#"+h.id),d.initTransformChromosome(f,b);if(d.config.annotationsPath){var u=
function(){"undefined"!==typeof timeout&&window.clearTimeout(timeout);d.annots=d.processAnnotData(d.rawAnnots);d.drawProcessedAnnots(d.annots);d.initCrossFilter&&d.initCrossFilter()};d.rawAnnots?u():function C(){timeout=setTimeout(function(){d.rawAnnots?u():C()},50)}()}if(!0===d.config.showBandLabels){var B=d.bandsToShow.join(","),J=(new Date).getTime();d3.selectAll(".bandLabel, .bandLabelStalk").style("display","none");d3.selectAll(B).style("display","");var H=(new Date).getTime();d.debug&&console.log("Time in showing bands: "+
(H-J)+" ms");if("vertical"===d.config.orientation)for(n=0;n<d.chromosomesArray.length;n++)d.rotateChromosomeLabels(d3.select("#"+d.chromosomesArray[n].id),n)}!0===d.config.showChromosomeLabels&&d.drawChromosomeLabels(d.chromosomes);1<d.config.rows&&d.putChromosomesInRows();!0===d.config.brush&&d.createBrush();d.config.annotations&&d.drawAnnots(d.config.annotations);if(d.config.armColors){var I=d.config.armColors;d.colorArms(I[0],I[1])}var M=(new Date).getTime();d.debug&&console.log("Time in drawChromosome: "+
(M-a)+" ms");var x=(new Date).getTime();d.debug&&console.log("Time constructing ideogram: "+(x-k)+" ms");if(d.onLoadCallback)d.onLoadCallback();if("rotatable"in d.config&&!1===d.config.rotatable)d3.selectAll(".chromosome").style("cursor","default");else d3.selectAll(".chromosome").on("click",function(){ideogram.rotateAndToggleDisplay(this.id)})}catch(y){console.log(y.stack)}}var a,e,g,h,d=this,k=(new Date).getTime(),l=[],m=0,n=this.config.resolution,p;(new Promise(function(a,b){d.getTaxids(a)})).then(function(b){e=
b[0];d.config.taxid=e;d.config.taxids=b;for(g=0;g<b.length;g++)e=b[g],d.config.assembly||(d.config.assembly="default"),p=d.organisms[e].assemblies[d.config.assembly],a={9606:"native/ideogram_9606_"+p+"_"+n+"_V1.js",10090:"native/ideogram_10090_"+p+"_NA_V2.js"},"undefined"===typeof chrBands&&e in a?d3.request(d.config.bandDir+a[e]).on("beforesend",function(a){a.taxid=e}).get(function(a,e){d.bandData[e.taxid]=e.response;m+=1;m==b.length&&(c(),f())}):("undefined"!==typeof chrBands&&(d.bandData[e]=chrBands),
c(),f())})};
//# sourceMappingURL=ideogram.js.map
