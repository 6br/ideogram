var Ideogram=function(c){this.config=c;this.debug=!1;this.config.container||(this.config.container="body");this.config.resolution||(this.config.resolution=850);this.config.brush||(this.config.brush=!1);this.config.rows||(this.config.rows=1);!1==="chrHeight"in c&&(c.chrHeight=500);this.bump=Math.round(c.chrHeight/125);c.showBandLabels&&(this.config.chrMargin+=20);this.config.annotationsPath?(this.config.annotationHeight||(this.config.annotationHeight=3),this.config.numAnnotTracks=this.config.annotationTracks?
this.config.annotationTracks.length:1,this.config.annotTracksHeight=this.config.annotationHeight*this.config.numAnnotTracks,"undefined"===typeof this.config.barWidth&&(this.config.barWidth=10)):this.config.annotTracksHeight=0;this.config.chrMargin=this.config.chrMargin+this.config.chrWidth+2*this.config.annotTracksHeight;c.onLoad&&(this.onLoadCallback=c.onLoad);this.coordinateSystem="iscn";this.maxLength={bp:0,iscn:0};this.organisms={9606:{commonName:"Human",scientificName:"Homo sapiens",scientificNameAbbr:"H. sapiens"},
10090:{commonName:"Mouse",scientificName:"Mus musculus",scientificNameAbbr:"M. musculus"}};this.config.annotationsPath&&!this.config.annotationHeight&&(this.config.annotationHeight=3);this.chromosomesArray=[];this.bandsToShow=[];this.chromosomes={};this.bandData={};this.init()};
Ideogram.prototype.getBands=function(c,e,a){var b=[],d,f,h,g;"undefined"===typeof chrBands?(delimiter=/\t/,c=c.split(/\r\n|\n/),h=1):(delimiter=/ /,h=0);for(g=c.length;h<g;h++)d=c[h].split(delimiter),d[0]===e&&(f=d[7],d[8]&&(f+=d[8]),d={chr:d[0],bp:{start:parseInt(d[5],10),stop:parseInt(d[6],10)},iscn:{start:parseInt(d[3],10),stop:parseInt(d[4],10)},px:{start:-1,stop:-1,width:-1},name:d[1]+d[2],stain:f,taxid:a},b.push(d));return b};
Ideogram.prototype.getChromosomeModel=function(c,e,a,b){var d={},f=this.config.chrHeight,h=this.maxLength,g;g=this.coordinateSystem;d.chrIndex=b;d.name=e;!0===this.config.fullChromosomeLabels&&(d.name=this.organisms[a].scientificNameAbbr+" chr"+d.name);d.id="chr"+e+"-"+a;d.length=c[c.length-1][g].stop;b=d.length;for(var k=pxStop=0;k<c.length;k++)e=c[k],a=f*d.length/h[g]*(e[g].stop-e[g].start)/b,c[k].px={start:pxStop,stop:pxStop+a,width:a},pxStop=c[k].px.stop,"acen"===e.stain&&"p"===e.name[0]&&(d.pcenIndex=
k);d.width=pxStop;d.scale={};!0===this.config.multiorganism?(d.scale.bp=1,d.scale.iscn=f*b/h.bp):(d.scale.bp=f/h.bp,d.scale.iscn=f/h.iscn);d.bands=c;d.centromerePosition="";1==c[0].bp.stop-c[0].bp.start&&(d.centromerePosition="telocentric",d.bands=d.bands.slice(1));return d};
Ideogram.prototype.drawChromosomeLabels=function(c){var e,a,b,d,f;a=[];for(b in c)for(e in c[b])a.push(c[b][e]);d=this;f=d.config.chrMargin-d.config.chrWidth-2;"vertical"===d.config.orientation&&!0===d.config.showBandLabels&&(f=d.config.chrMargin+8);"vertical"===d.config.orientation?d3.selectAll(".chromosome").append("text").data(a).attr("class","chrLabel").attr("transform","rotate(-90)").attr("y",-16).each(function(b,a){var c,e;c=b.name.split(" ");var m=[];if(void 0!=c)for(m.push(c.slice(0,c.length-
1).join(" ")),m.push(c[c.length-1]),d.config.showBandLabels||(a+=1),c=d.config.chrMargin*a,c=-(c+f)+3+2*d.config.annotTracksHeight,a=0;a<m.length;a++)e="",0==a&&d.config.fullChromosomeLabels&&(e="italic"),d3.select(this).append("tspan").text(m[a]).attr("dy",a?"1.2em":0).attr("x",c).attr("text-anchor","middle").attr("class",e)}):d3.selectAll(".chromosome").append("text").data(a).attr("class","chrLabel").attr("x",-5).each(function(b,a){var c,e;c=b.name.split(" ");var m=[];if(void 0!=c)for(m.push(c.slice(0,
c.length-1).join(" ")),m.push(c[c.length-1]),c=d.config.chrMargin*a,c=c+f+9,a=0;a<m.length;a++)e="",0==a&&d.config.fullChromosomeLabels&&(e="italic"),d3.select(this).append("tspan").text(m[a]).attr("dy",a?"1.2em":0).attr("y",c).attr("x",-8).attr("text-anchor","middle").attr("class",e)})};
Ideogram.prototype.drawBandLabels=function(c){var e,a,b;a=[];for(b in c)for(e in c[b])a.push(c[b][e]);var d={};for(c=chrIndex=0;c<a.length;c++){chrIndex+=1;chrModel=a[c];e=d3.select("#"+chrModel.id);var f=this.config.chrMargin*chrIndex,h;h=f;1==chrIndex&&"perspective"in this.config&&"comparative"==this.config.perspective&&(h+=18);d[chrModel.id]=[];e.selectAll("text").data(chrModel.bands).enter().append("g").attr("class",function(b,a){return"bandLabel bsbsl-"+a}).attr("transform",function(a){a=-8+
a.px.start+a.px.width/2;d[chrModel.id].push(a+13);return"translate("+a+","+(f-10)+")"}).append("text").text(function(a){return a.name});e.selectAll("line.bandLabelStalk").data(chrModel.bands).enter().append("g").attr("class",function(a,b){return"bandLabelStalk bsbsl-"+b}).attr("transform",function(a){return"translate("+(a.px.start+a.px.width/2)+", "+h+")"}).append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",-8)}for(c=0;c<a.length;c++){chrModel=a[c];var g=d[chrModel.id].length,k;b=[];
var l,m,p;for(e=k=0;e<g;e++)m=d[chrModel.id][e],!1===m<k+5?(b.push(e),l!==e&&(prevTextBoxLeft=d[chrModel.id][e],prevTextBoxWidth=36,p=prevTextBoxLeft+prevTextBoxWidth),m<p+5?(l=e,k=p):b.push(e)):(l=e,k=p);g=[];k=b.length;for(m=0;m<k;m++)e=b[m],g.push("#"+chrModel.id+" .bsbsl-"+e);this.bandsToShow=this.bandsToShow.concat(g)}};
Ideogram.prototype.rotateChromosomeLabels=function(c,e,a,b){var d,f,h,g,k,l,m;f=this.config.chrWidth;d=this.config.chrMargin*e;l=this.config.numAnnotTracks;h=this;"undefined"===typeof b||!b.hasOwnProperty("x")||1==b.x&&1==b.y?(g=-8,k=-16,b={x:1,y:1},m=""):(m="scale("+b.x+","+b.y+")",g=-2,k=""===b?-16:-12);"vertical"==a||""==a?c.selectAll("text.chrLabel").attr("transform",m).selectAll("tspan").attr("x",g).attr("y",function(b,d){var c=e-1;(1<l||""==a)&&--c;chrMargin2=-4;!0===h.config.showBandLabels&&
(chrMargin2=h.config.chrMargin+f+26);c*=h.config.chrMargin;0==1<l&&(c+=1);return c+chrMargin2}):(--e,chrMargin2=-f-2,!0===h.config.showBandLabels&&(chrMargin2=h.config.chrMargin+8),c.selectAll("text.chrLabel").attr("transform","rotate(-90)"+m).selectAll("tspan").attr("x",function(a,c){d=h.config.chrMargin*e;g=-(d+chrMargin2)+3+2*h.config.annotTracksHeight;return g/=b.x}).attr("y",k))};
Ideogram.prototype.rotateBandLabels=function(c,e,a){var b,d,f,h;h=c.selectAll(".bandLabel");b=this.config.chrMargin*e;f=c.attr("data-orientation");"undefined"==typeof a?(a={x:1,y:1},d=""):d="scale("+a.x+","+a.y+")";1==e&&"perspective"in this.config&&"comparative"==this.config.perspective?h.attr("transform",function(a){return"rotate(-90)translate("+(8-b-26)+","+(2+a.px.start+a.px.width/2)+")"}).selectAll("text").attr("text-anchor","end"):"vertical"==f?h.attr("transform",function(a){return"rotate(-90)translate("+
(8-b)+","+(2+a.px.start+a.px.width/2)+")"}).selectAll("text").attr("transform",d):(h.attr("transform",function(c){return"translate("+(-8*a.x+c.px.start+c.px.width/2)+","+(b-10)+")"}).selectAll("text").attr("transform",d),c.selectAll(".bandLabelStalk line").attr("transform",d))};
Ideogram.prototype.drawChromosome=function(c,e){var a,b,d,f,h,g,k,l;l=this;k=l.bump;g="telocentric"!=c.centromerePosition?k:Math.round(k/4);a=d3.select("svg").append("g").attr("id",c.id).attr("class","chromosome");b=l.config.chrWidth;d=c.width;var m=l.config.chrMargin*e;a.selectAll("path").data(c.bands).enter().append("path").attr("id",function(a){a=a.name.replace(".","-");return c.id+"-"+a}).attr("class",function(a){var b="band "+a.stain;"acen"==a.stain&&(b+=" "+a.name[0]+"-cen");return b}).attr("d",
function(a,c){var d=a.px.width,f=a.px.start;"acen"==a.stain?(d-=k/2,a="p"==a.name[0]?"M "+f+" "+m+" l "+d+" 0 q "+k+" "+b/2+" 0 "+b+" l -"+d+" 0 z":"M "+(f+d+k/2)+" "+m+" l -"+d+" 0 q -"+(k+.5)+" "+b/2+" 0 "+b+" l "+d+" 0 z"):(0==c&&(f+=g,!0===l.config.multiorganism&&(f+=g)),a="M "+f+" "+m+" l "+d+" 0 l 0 "+b+" l -"+d+" 0 z");return a});"telocentric"!=c.centromerePosition?a.append("path").attr("class","p-ter chromosomeBorder "+c.bands[0].stain).attr("d","M "+g+" "+m+" q -"+g+" "+b/2+" 0 "+b):(a.append("path").attr("class",
"p-ter chromosomeBorder "+c.bands[0].stain).attr("d","M "+g+" "+m+" l -"+g+" 0 l 0 "+b+" l "+g+" 0 z"),a.insert("path",":first-child").attr("class","acen").attr("d","M "+(g-1)+" "+(m+.1*b)+" l "+(g+k/2+1)+" 0 l 0 "+.8*b+" l -"+(g+k/2+1)+" 0 z"));a.append("path").attr("class","q-ter chromosomeBorder "+c.bands[c.bands.length-1].stain).attr("d","M "+d+" "+m+" q "+k+" "+b/2+" 0 "+b);d=c.pcenIndex;h=c.bands[d];f=c.bands[d+1];0<d?(d=h.px.start,f=f.px.stop):(d=5,f=document.querySelectorAll("#"+c.id+" .band")[0].getBBox().x);
h=c.width-f;a.append("line").attr("class","cb-p-arm-top chromosomeBorder").attr("x1",k).attr("y1",m).attr("x2",d).attr("y2",m);a.append("line").attr("class","cb-p-arm-bottom chromosomeBorder").attr("x1",k).attr("y1",b+m).attr("x2",d).attr("y2",b+m);a.append("line").attr("class","cb-q-arm-top chromosomeBorder").attr("x1",f).attr("y1",m).attr("x2",f+h).attr("y2",m);a.append("line").attr("class","cb-q-arm-bottom chromosomeBorder").attr("x1",f).attr("y1",b+m).attr("x2",f+h).attr("y2",b+m)};
Ideogram.prototype.initTransformChromosome=function(c,e){if("vertical"==this.config.orientation){var a,b;b=this.config.chrWidth;a=this.config.chrMargin*e;this.config.showBandLabels||(e+=2);a+=(b-4)*(e-1);c.attr("data-orientation","vertical").attr("transform","rotate(90, "+(a-30)+", "+a+")");this.rotateBandLabels(c,e)}else c.attr("data-orientation","horizontal")};
Ideogram.prototype.rotateAndToggleDisplay=function(c){var e,a,b,d,f,h,g,k,l=this;e=d3.select("#"+c);a=l.chromosomes[l.config.taxid][c.split("-")[0].split("chr")[1]].chrIndex;otherChrs=d3.selectAll("g.chromosome").filter(function(a,b){return this.id!==c});g=l.config.orientation;k=e.attr("data-orientation");b=this.config.chrMargin*a;d=this.config.chrWidth;f=d3.select("#ideogram")[0][0].getBoundingClientRect();h=f.height;f=f.width;"vertical"==g?(chrLength=e[0][0].getBoundingClientRect().height,f=f/chrLength*
.99,h=1.5,scale="scale("+f+", "+h+")",inverseScaleX=2/f,inverseScaleY=1,this.config.showBandLabels||(a+=2),d=b+(d-4)*(a-1)-30,verticalTransform="rotate(90, "+d+", "+(d+30)+")",b=-1*(b-this.config.annotTracksHeight)*h,this.config.showBandLabels&&(b+=25),horizontalTransform="rotate(0)translate(0, "+b+")"+scale):(chrLength=e[0][0].getBoundingClientRect().width,f=h/chrLength*.99,scale="scale("+f+", 1.5)",inverseScaleX=2/f,inverseScaleY=1,h=20,this.config.showBandLabels||(a+=2,h=15),b=d=b+(d-h)*(a-2),
this.config.showBandLabels||(d+=h,b+=h),verticalTransform="rotate(90, "+d+", "+b+")"+scale,horizontalTransform="");inverseScale="scale("+inverseScaleX+","+inverseScaleY+")";"vertical"!=k?("horizontal"==g&&otherChrs.style("display","none"),e.selectAll(".annot>path").attr("transform","vertical"==g?"":inverseScale),e.attr("data-orientation","vertical").transition().attr("transform",verticalTransform).each("end",function(){scale="vertical"==g?"":{x:inverseScaleY,y:inverseScaleX};l.rotateBandLabels(e,
a,scale);l.rotateChromosomeLabels(e,a,"horizontal",scale);"vertical"==g&&otherChrs.style("display","")})):(e.attr("data-orientation",""),"vertical"==g&&otherChrs.style("display","none"),e.selectAll(".annot>path").transition().attr("transform","vertical"==g?inverseScale:""),e.transition().attr("transform",horizontalTransform).each("end",function(){inverseScale="horizontal"==g?"vertical"==k?{x:1,y:1}:"":{x:inverseScaleX,y:inverseScaleY};l.rotateBandLabels(e,a,inverseScale);l.rotateChromosomeLabels(e,
a,"",inverseScale);"horizontal"==g&&otherChrs.style("display","")}))};Ideogram.prototype.convertBpToPx=function(c,e){var a,b;for(a=0;a<c.bands.length;a++)if(b=c.bands[a],e>=b.bp.start&&e<=b.bp.stop)return a=(b.iscn.stop-b.iscn.start)/(b.bp.stop-b.bp.start),a=b.iscn.start+(e-b.bp.start)*a,b=30+b.px.start+b.px.width*(a-b.iscn.start)/(b.iscn.stop-b.iscn.start);throw Error("Base pair out of range.  bp: "+e+"; length of chr"+c.name+": "+b.bp.stop);};
Ideogram.prototype.convertPxToBp=function(c,e){var a,b;for(a=0;a<c.bands.length;a++)if(b=c.bands[a],e>=b.px.start&&e<=b.px.stop)return pxToIscnScale=(b.iscn.stop-b.iscn.start)/(b.px.stop-b.px.start),a=b.iscn.start+(e-b.px.start)*pxToIscnScale,bp=b.bp.start+(b.bp.stop-b.bp.start)*(a-b.iscn.start)/(b.iscn.stop-b.iscn.start),Math.round(bp);throw Error("Pixel out of range.  px: "+bp+"; length of chr"+c.name+": "+b.px.stop);};
Ideogram.prototype.drawSynteny=function(c){var e=(new Date).getTime(),a,b,d,f,h,g,k,l,m;h=d3.select("svg").append("g").attr("class","synteny");for(g=0;g<c.length;g++)regions=c[g],a=regions.r1,b=regions.r2,k="#CFC","color"in regions&&(k=regions.color),l=1,"opacity"in regions&&(l=regions.opacity),a.startPx=this.convertBpToPx(a.chr,a.start),a.stopPx=this.convertBpToPx(a.chr,a.stop),b.startPx=this.convertBpToPx(b.chr,b.start),b.stopPx=this.convertBpToPx(b.chr,b.stop),d=document.querySelectorAll("#"+a.chr.id+
" path")[0].getBBox(),f=document.querySelectorAll("#"+b.chr.id+" path")[0].getBBox(),d=d.y-30,f=f.y-29,m=a.chr.id+"_"+a.start+"_"+a.stop+"___"+b.chr.id+"_"+b.start+"_"+b.stop,syntenicRegion=h.append("g").attr("class","syntenicRegion").attr("id",m).on("click",function(){var a=this,b=d3.selectAll(".syntenicRegion").filter(function(b,d){return this!==a});b.classed("hidden",!b.classed("hidden"))}).on("mouseover",function(){var a=this;d3.selectAll(".syntenicRegion").filter(function(b,d){return this!==
a}).classed("ghost",!0)}).on("mouseout",function(){d3.selectAll(".syntenicRegion").classed("ghost",!1)}),syntenicRegion.append("polygon").attr("points",d+", "+a.startPx+" "+d+", "+a.stopPx+" "+f+", "+b.stopPx+" "+f+", "+b.startPx).attr("style","fill: "+k+"; fill-opacity: "+l),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",d).attr("x2",f).attr("y1",a.startPx).attr("y2",b.startPx),syntenicRegion.append("line").attr("class","syntenyBorder").attr("x1",d).attr("x2",f).attr("y1",
a.stopPx).attr("y2",b.stopPx);c=(new Date).getTime();this.debug&&console.log("Time in drawSyntenicRegions: "+(c-e)+" ms")};
Ideogram.prototype.processAnnotData=function(c){var e,a,b,d,f,h,g,k;d=[];for(e=0;e<c.length;e++)for(annotsByChr=c[e],d.push({chr:annotsByChr.chr,annots:[]}),a=0;a<annotsByChr.annots.length;a++)f=annotsByChr.chr,ra=annotsByChr.annots[a],b=ra[1],h=ra[2],g=this.chromosomes["9606"][f],f=this.convertBpToPx(g,b),g=this.convertBpToPx(g,h),f=Math.round((f+g)/2)-28,k="#F00",this.config.annotationTracks?(g=ra[3],k=this.config.annotationTracks[g].color):g=0,b={id:ra[0],chrIndex:e,start:b,stop:h,px:f,color:k,
trackIndex:g},d[e].annots.push(b);return d};
Ideogram.prototype.getHistogramBars=function(c){var e=(new Date).getTime(),a,b,d,f,h,g,k,l,m;k=[];b=this.config.barWidth;f=this.chromosomes[this.config.taxid];for(d in f){chrModel=f[d];chrIndex=chrModel.chrIndex;lastBand=chrModel.bands[chrModel.bands.length-1];a=lastBand.px.stop;numBins=Math.round(a/b);g={chr:d,annots:[]};for(a=0;a<numBins;a++)h=a*b,bp=this.convertPxToBp(chrModel,h),g.annots.push({bp:bp,px:h,count:0,chrIndex:chrIndex,color:"#F00"});k.push(g)}for(d in c)for(g=c[d].annots,chrName=c[d].chr,
chrModel=f[chrName],chrIndex=chrModel.chrIndex,barAnnots=k[chrIndex-1].annots,a=0;a<g.length;a++)for(h=g[a],h=h.px,b=0;b<barAnnots.length-1;b++)if(l=barAnnots[b].px,m=barAnnots[b+1].px,h>l&&h<m){k[chrIndex-1].annots[b].count+=1;break}for(a=d=0;a<k.length;a++)for(c=k[a].annots,b=0;b<c.length;b++)barCount=c[b].count,barCount>d&&(d=barCount);for(a=0;a<k.length;a++)for(c=k[a].annots,b=0;b<c.length;b++)barCount=c[b].count,height=barCount/d*this.config.chrMargin-1,k[a].annots[b].height=height;c=(new Date).getTime();
this.debug&&console.log("Time spent in getHistogramBars: "+(c-e)+" ms");return k};
Ideogram.prototype.drawAnnots=function(c){var e,a,b,d,f,h,g,k,l,m=this;e=this.config.chrMargin;a=this.config.chrWidth;b="tracks";this.config.annotationsLayout&&(b=this.config.annotationsLayout);"histogram"===b&&(c=m.getHistogramBars(c));d=this.config.annotationHeight;f="l -"+d+" "+2*d+" l "+2*d+" 0 z";c=d3.selectAll(".chromosome").data(c).selectAll("path.annot").data(function(a){return a.annots}).enter();"tracks"===b?c.append("g").attr("id",function(a,b){return a.id}).attr("class","annot").attr("transform",
function(b){return"translate("+b.px+","+((b.chrIndex+1)*e+a+b.trackIndex*d*2)+")"}).append("path").attr("d","m0,0"+f).attr("fill",function(a){return a.color}):"overlay"===b?c.append("polygon").attr("id",function(a,b){return a.id}).attr("class","annot").attr("points",function(b){h=b.px-.5;g=b.px+.5;k=(b.chrIndex+1)*e+a;l=(b.chrIndex+1)*e;return h+","+k+" "+g+","+k+" "+g+","+l+" "+h+","+l}).attr("fill",function(a){return a.color}):"histogram"===b&&c.append("polygon").attr("class","annot").attr("points",
function(b){h=b.px+m.bump;g=b.px+m.config.barWidth+m.bump;k=b.chrIndex*e+a;l=b.chrIndex*e+a+b.height;b=m.chromosomesArray[b.chrIndex-1].width;g>b&&(g=b);return h+","+k+" "+g+","+k+" "+g+","+l+" "+h+","+l}).attr("fill",function(a){return a.color})};
Ideogram.prototype.putChromosomesInRows=function(){var c=this.config.rows,e,a,b,d,f;e=Math.floor(this.config.chromosomes[this.config.taxid].length/c);for(i=1;i<c;i++)a=e*i+1,b=a+e,range="nth-child(n+"+a+"):nth-child(-n+"+b+")",d=this.config.chrHeight+20,a+=1,b=this.config.chrWidth,f=this.config.chrMargin*a,this.config.showBandLabels||(a+=2),this.config.showChromosomeLabels&&(d+=12),rowWidth=f+(b-4)*a+8,d3.selectAll("#ideogram .chromosome:"+range).attr("transform",function(a,b){return d3.select(this).attr("transform")+
("translate("+d+", "+rowWidth+")")})};Ideogram.prototype.createBrush=function(c,e){var a=this.config.chrWidth+6.5,b=this.config.chrHeight,d,b=d3.scale.linear().range([0,b]);d=d3.select(".band")[0][0].getBBox().y-3.25;ideogramBrush=d3.svg.brush().x(b).extent([.1,.2]);d3.select("#ideogram").append("g").attr("class","brush").attr("transform","translate(0, "+d+")").call(ideogramBrush).selectAll("rect").attr("height",a)};Ideogram.prototype.onLoad=function(){call(this.onLoadCallback)};
Ideogram.prototype.init=function(){function c(){var b,c,e,g,l,n=f.config.taxids;k=[];var q=(new Date).getTime();for(e=0;e<n.length;e++)for(a=n[e],l=f.bandData[a],d=f.config.chromosomes[a],g=0;g<d.length;g++)b=d[g],c=f.getBands(l,b,a),k.push(c),b=c[c.length-1].iscn.stop,c=c[c.length-1].bp.stop,b>f.maxLength.iscn&&(f.maxLength.iscn=b),c>f.maxLength.bp&&(f.maxLength.bp=c);e=(new Date).getTime();this.debug&&console.log("Time in getBands: "+(e-q)+" ms");l=0;q=(new Date).getTime();for(e=0;e<n.length;e++){a=
n[e];d=f.config.chromosomes[a];f.chromosomes[a]={};for(g=0;g<d.length;g++)c=k[l],l+=1,b=d[g],c=f.getChromosomeModel(c,b,a,l),f.chromosomes[a][b]=c,f.chromosomesArray.push(c),f.drawChromosome(c,l);!0===f.config.showBandLabels&&f.drawBandLabels(f.chromosomes)}for(e=l=0;e<n.length;e++)for(a=n[e],d=f.config.chromosomes[a],g=0;g<d.length;g++)l+=1,b=d[g],chrModel=f.chromosomes[a][b],chr=d3.select("#chr"+b+"-"+a),f.initTransformChromosome(chr,l);if(f.config.annotationsPath){var r=function(){"undefined"!==
typeof timeout&&window.clearTimeout(timeout);f.annots=f.processAnnotData(f.rawAnnots);f.drawAnnots(f.annots)};f.rawAnnots?r():function t(){timeout=setTimeout(function(){f.rawAnnots?r():t()},50)}()}if(!0===f.config.showBandLabels&&(e=f.bandsToShow.join(","),n=(new Date).getTime(),d3.selectAll(".bandLabel, .bandLabelStalk").style("display","none"),d3.selectAll(e).style("display",""),e=(new Date).getTime(),this.debug&&console.log("Time in showing bands: "+(e-n)+" ms"),"vertical"===f.config.orientation))for(n=
0;n<f.chromosomesArray.length;n++)f.rotateChromosomeLabels(d3.select("#"+f.chromosomesArray[n].id),n);!0===f.config.showChromosomeLabels&&f.drawChromosomeLabels(f.chromosomes);1<f.config.rows&&f.putChromosomesInRows();!0===f.config.brush&&f.createBrush();n=(new Date).getTime();this.debug&&console.log("Time in drawChromosome: "+(n-q)+" ms");n=(new Date).getTime();this.debug&&console.log("Time constructing ideogram: "+(n-h)+" ms");if(f.onLoadCallback)f.onLoadCallback()}var e=!0===this.config.multiorganism,
a,b,d,f=this,h=(new Date).getTime();if(0==e)"undefined"==typeof this.config.taxid&&(this.config.taxid="9606"),a=this.config.taxid,b=[a],this.config.taxids=b,d=this.config.chromosomes.slice(),this.config.chromosomes={},this.config.chromosomes[a]=d;else for(this.coordinateSystem="bp",b=this.config.taxids,e=0;e<b.length;e++)a=b[e];this.config.annotationsPath&&d3.json(f.config.annotationsPath,function(a){f.rawAnnots=a.annots});e="";this.config.showChromosomeLabels&&(e="horizontal"==this.config.orientation?
e+"labeledLeft ":e+"labeled ");this.config.annotationsLayout&&"overlay"===this.config.annotationsLayout&&(e+="faint");var g=this.config.chrHeight+40;1<this.config.rows&&(g=this.config.rows*(g-40));d3.select(this.config.container).append("svg").attr("id","ideogram").attr("class",e).attr("width","97%").attr("height",g);for(var k=[],l=0,g=this.config.resolution,e=0;e<b.length;e++)a=b[e],bandDataFileNames={9606:"ideogram_9606_GCF_000001305.14_"+g+"_V1",10090:"ideogram_10090_GCF_000000055.19_NA_V2"},"undefined"===
typeof chrBands?d3.xhr("../data/bands/ncbi/"+bandDataFileNames[a]).on("beforesend",function(b){b.taxid=a}).get(function(a,d){f.bandData[d.taxid]=d.response;l+=1;l==b.length&&c()}):(f.bandData["9606"]=chrBands,c())};
//# sourceMappingURL=ideogram.js.map
