<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Annotations, basic | Ideogram</title>
  <link type="text/css" rel="stylesheet" href="../src/css/ideogram.css"/>
  <script type="text/javascript" src="../src/js/d3.min.js"></script>
  <script type="text/javascript" src="../src/js/ideogram.js"></script>
</head>
<body>
  <h1>Annotations, shapes | Ideogram</h1>
  <a href=".">Back to overview</a>

  <script type="text/javascript">

  function onIdeogramLoad() {

    var acmgGenes, gene, i, annots, annot,
        geneClause, geneID, geneIDs,
        eutils, esearch, esummary, url, defaultParams;

    geneIDs = [];
    annots = [];

    eutils = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/";
    defaultParams = "?db=gene&retmode=json";
    esearch = eutils + "esearch.fcgi" + defaultParams;
    esummary = eutils + "esummary.fcgi" + defaultParams;

    // "We recommend that laboratories performing clinical sequencing seek and
    // report mutations of the specified classes or types in the genes listed here."
    // ACMG Recommendations for Reporting of Incidental Findings in Clinical Exome and Genome Sequencing
    // This is that gene list, including official updates.
    // http://www.ncbi.nlm.nih.gov/clinvar/docs/acmg/
    acmgGenes = [
      "APC", "MYH11", "ACTA2", "MYLK", "TMEM43", "DSP", "PKP2", "DSG2", "DSC2",
      "BRCA1", "BRCA2", "SCN5A", "RYR2", "LMNA", "MYBPC3", "COL3A1", "GLA",
      "APOB", "LDLR", "MYH7", "TPM1", "MYBPC3", "PRKAG2", "TNNI3", "MYL3",
      "MYL2", "ACTC1", "RET", "PCSK9", "TNNT2", "TP53", "TGFBR1", "TGFBR2",
      "TGFBR1", "TGFBR2", "SMAD3", "KCNQ1", "KCNH2", "SCN5A", "MLH1", "MSH2",
      "MSH6", "PMS2", "RYR1", "CACNA1S", "FBN1", "TGFBR1", "MEN1", "RET",
      "MUTYH", "NF2", "SDHD", "SDHAF2", "SDHC", "SDHB", "STK11", "MUTYH",
      "PTEN", "RB1", "TSC1", "TSC2", "VHL"
    ];

    geneClause = acmgGenes.join("[symbol] OR ") + "[symbol]"

    url = esearch + "&term=Homo-sapiens[Organism] AND " + geneClause;
    d3.json(url, function(error, data) {
      geneIDs = data.esearchresult.idlist;
      url = esummary + "&id=" + geneIDs.join(",");
      d3.json(url, function(error, data) {
        for (var j = 0; j < geneIDs.length; j ++) {
          var result, chr, loc, start, stop;
          geneID = geneIDs[j];
          result = data.result[geneID];
          chr = result.chromosome;
          loc = result.locationhist[0]; // better than "genomicinfo"
          start = loc.chrstart;
          stop = loc.chrstop;
          annots.push({"name": gene, "chr": chr, "start": start, "stop": stop});
          ideogram.processFriendlyAnnots(annots);
        }
        // Placing processFriendlyAnnots here would be more efficient,
        // but the color of annotations turned from red to black.  Why?
        //ideogram.processFriendlyAnnots(annots);
      });
    })

  }

  var config = {
    organism: "human",
    resolution: 550,
    chrHeight: 500,
    onLoad: onIdeogramLoad
  };

  var ideogram = new Ideogram(config);

  </script>
</body>
</html>
